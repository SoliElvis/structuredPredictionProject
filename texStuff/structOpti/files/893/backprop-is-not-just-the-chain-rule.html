<html><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <title>Backprop is not just the chain rule — Graduate Descent</title>
  <meta name="author" content="Tim Vieira">

  <link href="https://timvieira.github.io/blog/atom.xml" type="application/atom+xml" rel="alternate" title="Graduate Descent Atom Feed">





  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">


    <link href="https://timvieira.github.io/blog/favicon.png" rel="icon">

  <link href="main.css" media="screen, projection" rel="stylesheet" type="text/css">

  <link href="css.css" rel="stylesheet" type="text/css">
  <link href="css_002.css" rel="stylesheet" type="text/css">
<style type="text/css"></style><style>@media print {#ghostery-purple-box {display:none !important}}</style><script async="" src="analytics.js"></script><script type="text/javascript" async="" src="embed.js"></script><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.9974049bf7b0591e5d4f055cb67f3ee3.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.880980e048a2432334f13013030456ac.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.4180262f1aa52e0f0340aac9fc52a8d8.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"><style type="text/css" id="cliqz-adblokcer-css-rules"> :root .adsbox {display:none !important;}</style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.0') format('opentype')}
.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn {color: inherit ! important}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">@font-face {font-family: MathJax_Math-bold-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Math-BoldItalic.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Math-BoldItalic.otf?V=2.7.0') format('opentype')}
</style></head>

<body data-gr-c-s-loaded="true"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
  <header role="banner"><hgroup>
  <h1><a href="https://timvieira.github.io/blog/">Graduate Descent</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="https://timvieira.github.io/blog/atom.xml" rel="subscribe-atom">Atom</a></li>
</ul>


<ul class="main-navigation">
    <li><a href="http://timvieira.github.io/">About</a></li>
    <li><a href="https://timvieira.github.io/blog/archives.html">Archive</a></li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Backprop is not just the chain rule</h1>
    <p class="meta">
<time datetime="2017-08-18T00:00:00-04:00" pubdate="">Aug 18, 2017</time>    </p>
</header>

  <div class="entry-content"><p>Almost everyone I know says that "backprop is just the chain rule." Although
that's <em>basically true</em>, there are some subtle and beautiful things about
automatic differentiation techniques (including backprop) that will not be
appreciated with this <em>dismissive</em> attitude.</p>
<p>This leads to a poor understanding. As
<a href="http://timvieira.github.io/blog/post/2016/09/25/evaluating-fx-is-as-fast-as-fx/">I have ranted before</a>:
people do not understand basic facts about autodiff.</p>
<ul>
<li>Evaluating <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 3.188em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.72em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1002.63em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Main;">∇</span><span class="mi" id="MathJax-Span-4" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="mo" id="MathJax-Span-5" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-6" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-7" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">∇</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1">\nabla f(x)</script></span> is provably as fast as evaluating <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-8" style="width: 2.204em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.876em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1001.78em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-9"><span class="mi" id="MathJax-Span-10" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="mo" id="MathJax-Span-11" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-12" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-13" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-2">f(x)</script></span>.</li>
</ul>
<!-- Let that sink in. Computing the gradient&mdash;an essential ingredient to
efficient optimization&mdash;is no slower to compute than the function
itself. Contrast that with the finite-difference gradient approximation, which
is quite accurate, but its runtime is $\textrm{dim}(x)$ times slower than
evaluating $f$
([discussed here](http://timvieira.github.io/blog/post/2017/04/21/how-to-test-gradient-implementations/))!
-->

<ul>
<li>Code for <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-14" style="width: 3.188em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.72em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1002.63em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-15"><span class="mi" id="MathJax-Span-16" style="font-family: MathJax_Main;">∇</span><span class="mi" id="MathJax-Span-17" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="mo" id="MathJax-Span-18" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-19" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-20" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">∇</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">\nabla f(x)</script></span> can be derived by a rote program transformation, even
  if the code has control flow structures like loops and intermediate variables
  (as long as the control flow is independent of <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-21" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.565em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1000.52em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-22"><span class="mi" id="MathJax-Span-23" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-4">x</script></span>). You can even do this
  "automatic" transformation by hand!</li>
</ul>
<h3>Autodiff <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2260;&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-24" style="width: 0.939em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.795em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.516em, 1000.75em, 2.669em, -999.986em); top: -2.341em; left: 0em;"><span class="mrow" id="MathJax-Span-25"><span class="mo" id="MathJax-Span-26" style="font-family: MathJax_Main;">≠</span></span><span style="display: inline-block; width: 0px; height: 2.345em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.291em; border-left: 0px solid; width: 0px; height: 1.173em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>≠</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">\ne</script></span> what you learned in calculus</h3>
<p>Let's try to understand the difference between autodiff and the type of
differentiation that you learned in calculus, which is called <em>symbolic</em>
differentiation.</p>
<p>I'm going to use an example from
<a href="https://people.cs.umass.edu/%7Edomke/courses/sml2011/08autodiff_nnets.pdf">Justin Domke's notes</a>,
</p>
<div class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;exp&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;exp&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;exp&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;exp&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;exp&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-27" style="width: 27.692em; display: inline-block;"><span style="display: inline-block; position: relative; width: 23.85em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.267em, 1023.76em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-28"><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="mo" id="MathJax-Span-30" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-31" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-32" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-33" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mi" id="MathJax-Span-34" style="font-family: MathJax_Main; padding-left: 0.283em;">exp</span><span class="mo" id="MathJax-Span-35"></span><span class="mo" id="MathJax-Span-36" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-37" style="font-family: MathJax_Main;">exp</span><span class="mo" id="MathJax-Span-38"></span><span class="mo" id="MathJax-Span-39" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-41" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-42" style="font-family: MathJax_Main; padding-left: 0.237em;">+</span><span class="mi" id="MathJax-Span-43" style="font-family: MathJax_Main; padding-left: 0.237em;">exp</span><span class="mo" id="MathJax-Span-44"></span><span class="mo" id="MathJax-Span-45" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-46" style="font-family: MathJax_Math-italic;">x</span><span class="msubsup" id="MathJax-Span-47"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.095em, 1000.28em, 4.36em, -999.998em); top: -3.98em; left: 0em;"><span class="mo" id="MathJax-Span-48" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.377em;"><span class="mn" id="MathJax-Span-49" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-50" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-51" style="font-family: MathJax_Main; padding-left: 0.237em;">+</span><span class="mi" id="MathJax-Span-52" style="font-family: MathJax_Main; padding-left: 0.237em;">sin</span><span class="mo" id="MathJax-Span-53"></span><span class="mo" id="MathJax-Span-54" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-55" style="font-family: MathJax_Main;">exp</span><span class="mo" id="MathJax-Span-56"></span><span class="mo" id="MathJax-Span-57" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-58" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-59" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-60" style="font-family: MathJax_Main; padding-left: 0.237em;">+</span><span class="mi" id="MathJax-Span-61" style="font-family: MathJax_Main; padding-left: 0.237em;">exp</span><span class="mo" id="MathJax-Span-62"></span><span class="mo" id="MathJax-Span-63" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-64" style="font-family: MathJax_Math-italic;">x</span><span class="msubsup" id="MathJax-Span-65"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.095em, 1000.28em, 4.36em, -999.998em); top: -3.98em; left: 0em;"><span class="mo" id="MathJax-Span-66" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.377em;"><span class="mn" id="MathJax-Span-67" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-68" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-69" style="font-family: MathJax_Main;">.</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.416em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo><mo>.</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-6">
f(x) = \exp(\exp(x) + \exp(x)^2) + \sin(\exp(x) + \exp(x)^2).
</script></div>
<!--
If we plug-and-chug with the chain rule, we get a correct expression for the
derivative,
$$\small
\frac{\partial f}{\partial x} =
\exp(\exp(x) + \exp(x)^2) (\exp(x) + 2 \exp(x) \exp(x)) \\
\quad\quad\small+ \cos(\exp(x) + \exp(x)^2) (\exp(x) + 2 \exp(x) \exp(x)).
$$

However, this expression leaves something to be desired because it has lot of
repeated evaluations of the same function. This is clearly bad, if we want to
turn it into source code.
-->

<p>If we were writing <em>a program</em> (e.g., in Python) to compute <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-70" style="width: 0.611em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.518em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.52em, 2.626em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-71"><span class="mi" id="MathJax-Span-72" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.269em; border-left: 0px solid; width: 0px; height: 1.144em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">f</script></span>, we'd definitely
take advantage of the fact that it has a lot of repeated evaluations for
efficiency.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span> <span class="o">+</span> <span class="n">e</span>
</pre></div>


<p>Symbolic differentiation would have to use the "flat" version of this function,
so no intermediate variable <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x21D2;&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-73" style="width: 1.174em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.642em, 1000.94em, 2.485em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-74"><span class="mo" id="MathJax-Span-75" style="font-family: MathJax_Main;">⇒</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.106em; border-left: 0px solid; width: 0px; height: 0.764em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">⇒</mo></math></span></span><script type="math/tex" id="MathJax-Element-8">\Rightarrow</script></span> slow.</p>
<p>Automatic differentiation lets us differentiate a program with <em>intermediate</em>
variables.</p>
<ul>
<li>
<p>The rules for transforming the code for a function into code for the gradient
  are really minimal (fewer things to memorize!). Additionally, the rules are
  more general than in symbolic case because they handle as superset of
  programs.</p>
</li>
<li>
<p>Quite <a href="http://conal.net/papers/beautiful-differentiation/">beautifully</a>, the
  program for the gradient <em>has exactly the same structure</em> as the function,
  which implies that we get the same runtime (up to some constants factors).</p>
</li>
</ul>
<p>I won't give the details of how to execute the backpropagation transform to the
program. You can get that from
<a href="https://people.cs.umass.edu/%7Edomke/courses/sml2011/08autodiff_nnets.pdf">Justin Domke's notes</a>
and many other good
resources. <a href="https://gist.github.com/timvieira/39e27756e1226c2dbd6c36e83b648ec2">Here's some code</a>
that I wrote that accompanies to the <code>f(x)</code> example, which has a bunch of
comments describing the manual "automatic" differentiation process on <code>f(x)</code>.</p>
<!--
Caveat: You might have seen some *limited* cases where an input variable was
reused, but chances are that it was something really simple like multiplication
or division, e.g., $\nabla\! \left[ f(x) \cdot g(x) \right] = f(x) \cdot g'(x)
+ f'(x) \cdot g(x)$, and you just memorized a rule. The rules of autodiff are
simpler and actually explains why there is a sum in the product rule. You can
also rederive the quotient rule without a hitch. I'm all about having fewer
things to memorize!
-->

<!--
You might hope that something like common subexpression elimination would save
the symbolic approach. Indeed that could be leveraged to improve any chunk of
code, but to match efficiency it's not needed! If we had needed to blow up the
computation to then shrink it down that would be much less efficient! The "flat"
version of a program can be exponentially larger than a version with reuse.
-->

<!-- Only sort of related: think of the exponential blow up in converting a
Boolean expression from conjunctive normal form to and disjunction normal.  -->

<h2>Autodiff by the method of Lagrange multipliers</h2>
<p>Let's view the intermediate variables in our optimization problem as simple
equality constraints in an equivalent <em>constrained</em> optimization problem. It
turns out that the de facto method for handling constraints, the method Lagrange
multipliers, recovers <em>exactly</em> the adjoints (intermediate derivatives) in the
backprop algorithm!</p>
<p>Here's our example from earlier written in this constraint form:</p>
<div class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left right left right left right left right left right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;munder&gt;&lt;mtext&gt;argmax&lt;/mtext&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/munder&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;s.t.&lt;/mtext&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;exp&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;exp&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-76" style="width: 9.42em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.108em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(-2.949em, 1007.83em, 7.077em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-77"><span class="mtable" id="MathJax-Span-78" style="padding-right: 0.19em; padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 7.733em; height: 0px;"><span style="position: absolute; clip: rect(5.484em, 1003.24em, 15.182em, -999.998em); top: -10.399em; left: 0em;"><span style="display: inline-block; position: relative; width: 3.516em; height: 0px;"><span style="position: absolute; clip: rect(3.376em, 1003.24em, 5.062em, -999.998em); top: -8.29em; right: 0em;"><span class="mtd" id="MathJax-Span-79"><span class="mrow" id="MathJax-Span-80"><span class="munder" id="MathJax-Span-81"><span style="display: inline-block; position: relative; width: 3.235em; height: 0px;"><span style="position: absolute; clip: rect(3.376em, 1003.24em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mtext" id="MathJax-Span-82" style="font-family: MathJax_Main;">argmax</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.516em, 1000.38em, 4.219em, -999.998em); top: -3.184em; left: 1.408em;"><span class="mi" id="MathJax-Span-83" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mtext" id="MathJax-Span-84" style="font-family: MathJax_Main;">&nbsp;</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.235em, 1002.86em, 4.125em, -999.998em); top: -6.276em; right: 0em;"><span class="mtd" id="MathJax-Span-88"><span class="mrow" id="MathJax-Span-89"><span class="mtext" id="MathJax-Span-90" style="font-family: MathJax_Main;">s.t.</span><span class="mspace" id="MathJax-Span-91" style="height: 0em; vertical-align: 0em; width: 0.986em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-92" style="font-family: MathJax_Math-italic;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1000.42em, 4.125em, -999.998em); top: -4.87em; right: 0em;"><span class="mtd" id="MathJax-Span-102"><span class="mrow" id="MathJax-Span-103"><span class="mi" id="MathJax-Span-104" style="font-family: MathJax_Math-italic;">b</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.423em, 1000.42em, 4.125em, -999.998em); top: -3.558em; right: 0em;"><span class="mtd" id="MathJax-Span-112"><span class="mrow" id="MathJax-Span-113"><span class="mi" id="MathJax-Span-114" style="font-family: MathJax_Math-italic;">c</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1000.52em, 4.125em, -999.998em); top: -2.247em; right: 0em;"><span class="mtd" id="MathJax-Span-122"><span class="mrow" id="MathJax-Span-123"><span class="mi" id="MathJax-Span-124" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.423em, 1000.42em, 4.125em, -999.998em); top: -0.888em; right: 0em;"><span class="mtd" id="MathJax-Span-134"><span class="mrow" id="MathJax-Span-135"><span class="mi" id="MathJax-Span-136" style="font-family: MathJax_Math-italic;">e</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: 0.424em; right: 0em;"><span class="mtd" id="MathJax-Span-146"><span class="mrow" id="MathJax-Span-147"><span class="mi" id="MathJax-Span-148" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 10.403em;"></span></span><span style="position: absolute; clip: rect(5.39em, 1004.12em, 15.182em, -999.998em); top: -10.539em; left: 3.516em;"><span style="display: inline-block; position: relative; width: 4.219em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -8.29em; left: 0em;"><span class="mtd" id="MathJax-Span-85"><span class="mrow" id="MathJax-Span-86"><span class="mi" id="MathJax-Span-87" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.095em, 1004.12em, 4.36em, -999.998em); top: -6.276em; left: 0em;"><span class="mtd" id="MathJax-Span-93"><span class="mrow" id="MathJax-Span-94"><span class="mi" id="MathJax-Span-95"></span><span class="mo" id="MathJax-Span-96" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mi" id="MathJax-Span-97" style="font-family: MathJax_Main; padding-left: 0.283em;">exp</span><span class="mo" id="MathJax-Span-98"></span><span class="mo" id="MathJax-Span-99" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-100" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-101" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(2.954em, 1002.3em, 4.125em, -999.998em); top: -4.87em; left: 0em;"><span class="mtd" id="MathJax-Span-105"><span class="mrow" id="MathJax-Span-106"><span class="mi" id="MathJax-Span-107"></span><span class="mo" id="MathJax-Span-108" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="msubsup" id="MathJax-Span-109" style="padding-left: 0.283em;"><span style="display: inline-block; position: relative; width: 0.939em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.52em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-110" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.518em;"><span class="mn" id="MathJax-Span-111" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1003.56em, 4.219em, -999.998em); top: -3.558em; left: 0em;"><span class="mtd" id="MathJax-Span-115"><span class="mrow" id="MathJax-Span-116"><span class="mi" id="MathJax-Span-117"></span><span class="mo" id="MathJax-Span-118" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mi" id="MathJax-Span-119" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">a</span><span class="mo" id="MathJax-Span-120" style="font-family: MathJax_Main; padding-left: 0.237em;">+</span><span class="mi" id="MathJax-Span-121" style="font-family: MathJax_Math-italic; padding-left: 0.237em;">b</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.095em, 1003.99em, 4.36em, -999.998em); top: -2.247em; left: 0em;"><span class="mtd" id="MathJax-Span-125"><span class="mrow" id="MathJax-Span-126"><span class="mi" id="MathJax-Span-127"></span><span class="mo" id="MathJax-Span-128" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mi" id="MathJax-Span-129" style="font-family: MathJax_Main; padding-left: 0.283em;">exp</span><span class="mo" id="MathJax-Span-130"></span><span class="mo" id="MathJax-Span-131" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-132" style="font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-133" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.095em, 1003.7em, 4.36em, -999.998em); top: -0.888em; left: 0em;"><span class="mtd" id="MathJax-Span-137"><span class="mrow" id="MathJax-Span-138"><span class="mi" id="MathJax-Span-139"></span><span class="mo" id="MathJax-Span-140" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mi" id="MathJax-Span-141" style="font-family: MathJax_Main; padding-left: 0.283em;">sin</span><span class="mo" id="MathJax-Span-142"></span><span class="mo" id="MathJax-Span-143" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-144" style="font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-145" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1003.56em, 4.219em, -999.998em); top: 0.424em; left: 0em;"><span class="mtd" id="MathJax-Span-149"><span class="mrow" id="MathJax-Span-150"><span class="mi" id="MathJax-Span-151"></span><span class="mo" id="MathJax-Span-152" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mi" id="MathJax-Span-153" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-154" style="font-family: MathJax_Main; padding-left: 0.237em;">+</span><span class="mi" id="MathJax-Span-155" style="font-family: MathJax_Math-italic; padding-left: 0.237em;">e</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 10.544em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -5.432em; border-left: 0px solid; width: 0px; height: 11.416em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mtr><mtd><munder><mtext>argmax</mtext><mi>x</mi></munder><mtext>&nbsp;</mtext></mtd><mtd><mi>f</mi></mtd></mtr><mtr><mtd><mtext>s.t.</mtext><mspace width="1em"></mspace><mi>a</mi></mtd><mtd><mi></mi><mo>=</mo><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mi>b</mi></mtd><mtd><mi></mi><mo>=</mo><msup><mi>a</mi><mn>2</mn></msup></mtd></mtr><mtr><mtd><mi>c</mi></mtd><mtd><mi></mi><mo>=</mo><mi>a</mi><mo>+</mo><mi>b</mi></mtd></mtr><mtr><mtd><mi>d</mi></mtd><mtd><mi></mi><mo>=</mo><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>c</mi><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mi>e</mi></mtd><mtd><mi></mi><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>c</mi><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mi>f</mi></mtd><mtd><mi></mi><mo>=</mo><mi>d</mi><mo>+</mo><mi>e</mi></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-9">
\begin{align*}
\underset{x}{\text{argmax}}\ & f \\
\text{s.t.} \quad
a &= \exp(x) \\
b &= a^2     \\
c &= a + b   \\
d &= \exp(c) \\
e &= \sin(c) \\
f &= d + e
\end{align*}
</script></div>
<h4>The general formulation</h4>
<div class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left right left right left right left right left right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;munder&gt;&lt;mtext&gt;argmax&lt;/mtext&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;/munder&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd /&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mtext&gt;s.t.&lt;/mtext&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mtext&gt;&amp;#xA0;for&amp;#xA0;&lt;/mtext&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mphantom&gt;&lt;mtext&gt;s.t.&lt;/mtext&gt;&lt;/mphantom&gt;&lt;/mrow&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mtext&gt;&amp;#xA0;for&amp;#xA0;&lt;/mtext&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-156" style="width: 18.649em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.072em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(-0.326em, 1015.88em, 4.406em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-157"><span class="mtable" id="MathJax-Span-158" style="padding-right: 0.19em; padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 15.698em; height: 0px;"><span style="position: absolute; clip: rect(2.485em, 1000em, 6.093em, -999.998em); top: -4.308em; left: 0em;"><span style="display: inline-block; position: relative; width: 0em; height: 0px;"><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -5.667em; right: 0em;"><span class="mtd" id="MathJax-Span-159"><span class="mrow" id="MathJax-Span-160"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -3.652em; right: 0em;"><span class="mtd" id="MathJax-Span-172"><span class="mrow" id="MathJax-Span-173"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -2.34em; right: 0em;"><span class="mtd" id="MathJax-Span-196"><span class="mrow" id="MathJax-Span-197"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.313em;"></span></span><span style="position: absolute; clip: rect(2.813em, 1007.73em, 7.217em, -999.998em); top: -5.104em; left: 0em;"><span style="display: inline-block; position: relative; width: 7.827em; height: 0px;"><span style="position: absolute; clip: rect(3.376em, 1004.45em, 5.015em, -999.998em); top: -5.667em; left: 0em;"><span class="mtd" id="MathJax-Span-161"><span class="mrow" id="MathJax-Span-162"><span class="munder" id="MathJax-Span-163"><span style="display: inline-block; position: relative; width: 3.235em; height: 0px;"><span style="position: absolute; clip: rect(3.376em, 1003.24em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mtext" id="MathJax-Span-164" style="font-family: MathJax_Main;">argmax</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.516em, 1000.42em, 4.219em, -999.998em); top: -3.184em; left: 1.408em;"><span class="mi" id="MathJax-Span-165" style="font-size: 70.7%; font-family: MathJax_Math-bold-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mtext" id="MathJax-Span-166" style="font-family: MathJax_Main;">&nbsp;</span><span class="msubsup" id="MathJax-Span-167"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-168" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-169" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.235em, 1005.34em, 4.266em, -999.998em); top: -3.652em; left: 0em;"><span class="mtd" id="MathJax-Span-174"><span class="mrow" id="MathJax-Span-175"><span class="mtext" id="MathJax-Span-176" style="font-family: MathJax_Main;">s.t.</span><span class="mspace" id="MathJax-Span-177" style="height: 0em; vertical-align: 0em; width: 0.986em; display: inline-block; overflow: hidden;"></span><span class="msubsup" id="MathJax-Span-178"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-179" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-180" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-181" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="msubsup" id="MathJax-Span-182" style="padding-left: 0.283em;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.52em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-183" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-184" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.095em, 1007.73em, 4.5em, -999.998em); top: -2.34em; left: 0em;"><span class="mtd" id="MathJax-Span-198"><span class="mrow" id="MathJax-Span-199"><span class="texatom" id="MathJax-Span-200"><span class="mrow" id="MathJax-Span-201"><span class="mphantom" id="MathJax-Span-202"><span class="mrow" id="MathJax-Span-203" style="visibility: hidden;"><span class="mtext" id="MathJax-Span-204" style="font-family: MathJax_Main;">s.t.</span></span></span></span></span><span class="mspace" id="MathJax-Span-205" style="height: 0em; vertical-align: 0em; width: 0.986em; display: inline-block; overflow: hidden;"></span><span class="msubsup" id="MathJax-Span-206"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-207" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-208" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-209" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="msubsup" id="MathJax-Span-210" style="padding-left: 0.283em;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-211" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-212" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-213" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-214"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-215" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-216"><span class="mrow" id="MathJax-Span-217"><span class="mi" id="MathJax-Span-218" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-219" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-220" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-221" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-222" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.109em;"></span></span><span style="position: absolute; clip: rect(2.626em, 1005.86em, 6.374em, -999.998em); top: -4.449em; left: 9.841em;"><span style="display: inline-block; position: relative; width: 5.859em; height: 0px;"><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -5.667em; right: 0em;"><span class="mtd" id="MathJax-Span-170"><span class="mrow" id="MathJax-Span-171"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1005.76em, 4.266em, -999.998em); top: -3.652em; right: 0em;"><span class="mtd" id="MathJax-Span-185"><span class="mrow" id="MathJax-Span-186"><span class="mrow" id="MathJax-Span-187"><span class="mtext" id="MathJax-Span-188" style="font-family: MathJax_Main;">&nbsp;for&nbsp;</span><span class="texatom" id="MathJax-Span-189"><span class="mrow" id="MathJax-Span-190"><span class="mn" id="MathJax-Span-191" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-192" style="font-family: MathJax_Main; padding-left: 0.283em;">≤</span><span class="mi" id="MathJax-Span-193" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">i</span><span class="mo" id="MathJax-Span-194" style="font-family: MathJax_Main; padding-left: 0.283em;">≤</span><span class="mi" id="MathJax-Span-195" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1005.86em, 4.266em, -999.998em); top: -2.34em; right: 0em;"><span class="mtd" id="MathJax-Span-223"><span class="mrow" id="MathJax-Span-224"><span class="mrow" id="MathJax-Span-225"><span class="mtext" id="MathJax-Span-226" style="font-family: MathJax_Main;">&nbsp;for&nbsp;</span><span class="texatom" id="MathJax-Span-227"><span class="mrow" id="MathJax-Span-228"><span class="mi" id="MathJax-Span-229" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-230" style="font-family: MathJax_Main; padding-left: 0.283em;">&lt;</span><span class="mi" id="MathJax-Span-231" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">i</span><span class="mo" id="MathJax-Span-232" style="font-family: MathJax_Main; padding-left: 0.283em;">≤</span><span class="mi" id="MathJax-Span-233" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">n</span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.453em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.334em; border-left: 0px solid; width: 0px; height: 5.274em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mtr><mtd></mtd><mtd><munder><mtext>argmax</mtext><mi mathvariant="bold-italic">x</mi></munder><mtext>&nbsp;</mtext><msub><mi>z</mi><mi>n</mi></msub></mtd><mtd></mtd></mtr><mtr><mtd></mtd><mtd><mtext>s.t.</mtext><mspace width="1em"></mspace><msub><mi>z</mi><mi>i</mi></msub><mo>=</mo><msub><mi>x</mi><mi>i</mi></msub></mtd><mtd><mrow><mtext>&nbsp;for&nbsp;</mtext><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>d</mi></mrow></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mrow class="MJX-TeXAtom-ORD"><mphantom><mtext>s.t.</mtext></mphantom></mrow><mspace width="1em"></mspace><msub><mi>z</mi><mi>i</mi></msub><mo>=</mo><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mtd><mtd><mrow><mtext>&nbsp;for&nbsp;</mtext><mrow class="MJX-TeXAtom-ORD"><mi>d</mi><mo>&lt;</mo><mi>i</mi><mo>≤</mo><mi>n</mi></mrow></mrow></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-10">\begin{align*}
  & \underset{\boldsymbol{x}}{\text{argmax}}\ z_n & \\
  & \text{s.t.}\quad z_i = x_i                          &\text{ for $1 \le i \le d$} \\
  & \phantom{\text{s.t.}}\quad z_i = f_i(z_{\alpha(i)}) &\text{ for $d < i \le n$} \\
  \end{align*}</script></div>
<p>The first set of constraint (<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-234" style="width: 3.891em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.329em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1003.33em, 2.626em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-235"><span class="mn" id="MathJax-Span-236" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-237" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-238" style="font-family: MathJax_Main; padding-left: 0.19em;">…</span><span class="mo" id="MathJax-Span-239" style="font-family: MathJax_Main; padding-left: 0.19em;">,</span><span class="mi" id="MathJax-Span-240" style="font-family: MathJax_Math-italic; padding-left: 0.19em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.269em; border-left: 0px solid; width: 0px; height: 1.144em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>,</mo><mo>…</mo><mo>,</mo><mi>d</mi></math></span></span><script type="math/tex" id="MathJax-Element-11">1, \ldots, d</script></span>) are a little silly. They are only
there to keep our formulation tidy. The variables in the program fall into three
categories:</p>
<ul>
<li>
<p><strong>input variables</strong> (<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-241" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.689em, 1000.61em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-242"><span class="mi" id="MathJax-Span-243" style="font-family: MathJax_Math-bold-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">x</mi></math></span></span><script type="math/tex" id="MathJax-Element-12">\boldsymbol{x}</script></span>): <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-244" style="width: 5.015em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.313em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1004.31em, 2.626em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-245"><span class="msubsup" id="MathJax-Span-246"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.52em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-247" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mn" id="MathJax-Span-248" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-249" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-250" style="font-family: MathJax_Main; padding-left: 0.19em;">…</span><span class="mo" id="MathJax-Span-251" style="font-family: MathJax_Main; padding-left: 0.19em;">,</span><span class="msubsup" id="MathJax-Span-252" style="padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 1.033em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.52em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-253" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-254" style="font-size: 70.7%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.269em; border-left: 0px solid; width: 0px; height: 0.872em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mo>…</mo><mo>,</mo><msub><mi>x</mi><mi>d</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-13">x_1, \ldots, x_d</script></span></p>
</li>
<li>
<p><strong>intermediate variables</strong>: (<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-255" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.565em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.689em, 1000.57em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-256"><span class="mi" id="MathJax-Span-257" style="font-family: MathJax_Math-bold-italic;">z</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">z</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">\boldsymbol{z}</script></span>): <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-258" style="width: 6.374em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.484em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1005.39em, 2.813em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-259"><span class="msubsup" id="MathJax-Span-260"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-261" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-262" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-263" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="msubsup" id="MathJax-Span-264" style="padding-left: 0.283em;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-265" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-266" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-267" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-268"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-269" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-270"><span class="mrow" id="MathJax-Span-271"><span class="mi" id="MathJax-Span-272" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-273" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-274" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-275" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-276" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.486em; border-left: 0px solid; width: 0px; height: 1.416em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>z</mi><mi>i</mi></msub><mo>=</mo><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-15">z_i = f_i(z_{\alpha(i)})</script></span> for
  <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-277" style="width: 4.781em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.125em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.502em, 1004.12em, 2.579em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-278"><span class="mn" id="MathJax-Span-279" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-280" style="font-family: MathJax_Main; padding-left: 0.283em;">≤</span><span class="mi" id="MathJax-Span-281" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">i</span><span class="mo" id="MathJax-Span-282" style="font-family: MathJax_Main; padding-left: 0.283em;">≤</span><span class="mi" id="MathJax-Span-283" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">n</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.215em; border-left: 0px solid; width: 0px; height: 1.035em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-16">1 \le i \le n</script></span>, where <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-284" style="width: 2.064em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1001.69em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-285"><span class="mi" id="MathJax-Span-286" style="font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-287" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-288" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-289" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-17">\alpha(i)</script></span> is a list of indices from <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-290" style="width: 7.124em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.14em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1006.09em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-291"><span class="mo" id="MathJax-Span-292" style="font-family: MathJax_Main;">{</span><span class="mn" id="MathJax-Span-293" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-294" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-295" style="font-family: MathJax_Main; padding-left: 0.19em;">…</span><span class="mo" id="MathJax-Span-296" style="font-family: MathJax_Main; padding-left: 0.19em;">,</span><span class="mi" id="MathJax-Span-297" style="font-family: MathJax_Math-italic; padding-left: 0.19em;">n</span><span class="mo" id="MathJax-Span-298" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="mn" id="MathJax-Span-299" style="font-family: MathJax_Main; padding-left: 0.237em;">1</span><span class="mo" id="MathJax-Span-300" style="font-family: MathJax_Main;">}</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">{</mo><mn>1</mn><mo>,</mo><mo>…</mo><mo>,</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-18">\{1, \ldots,
  n-1\}</script></span> and <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-301" style="width: 2.064em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1001.78em, 2.813em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-302"><span class="msubsup" id="MathJax-Span-303"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-304" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-305"><span class="mrow" id="MathJax-Span-306"><span class="mi" id="MathJax-Span-307" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-308" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-309" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-310" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.486em; border-left: 0px solid; width: 0px; height: 1.035em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-19">z_{\alpha(i)}</script></span> is the subvector of variables needed to evaluate
  <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-311" style="width: 2.204em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.876em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1001.78em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-312"><span class="msubsup" id="MathJax-Span-313"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-314" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-315" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-316" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-317" style="font-family: MathJax_Main;">⋅</span><span class="mo" id="MathJax-Span-318" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mo>⋅</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-20">f_i(\cdot)</script></span>. Minor detail: take <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-319" style="width: 1.736em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.502em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1001.5em, 2.626em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-320"><span class="msubsup" id="MathJax-Span-321"><span style="display: inline-block; position: relative; width: 1.502em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-322" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="texatom" id="MathJax-Span-323"><span class="mrow" id="MathJax-Span-324"><span class="mn" id="MathJax-Span-325" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-326" style="font-size: 70.7%; font-family: MathJax_Main;">:</span><span class="mi" id="MathJax-Span-327" style="font-size: 70.7%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.269em; border-left: 0px solid; width: 0px; height: 1.144em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>f</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>d</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-21">f_{1:d}</script></span> to be the identity function.</p>
</li>
<li>
<p><strong>output variable</strong> (<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-328" style="width: 1.174em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1000.99em, 2.579em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-329"><span class="msubsup" id="MathJax-Span-330"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-331" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-332" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.215em; border-left: 0px solid; width: 0px; height: 0.818em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>z</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-22">z_n</script></span>): We assume that our programs has a singled scalar
  output variable, <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-333" style="width: 1.174em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1000.99em, 2.579em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-334"><span class="msubsup" id="MathJax-Span-335"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-336" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-337" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.215em; border-left: 0px solid; width: 0px; height: 0.818em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>z</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-23">z_n</script></span>, which represents the quantity we'd like to maximize.</p>
</li>
</ul>
<!-- (It is possible to generalize this story to compute Jacobians of functions
with multi-variate outputs by "scalarizing" the objective, e.g., multiply the
outputs by a vector. This Gives an efficient program for computing Jacobian
vector products that can be used to extra Jacobians.)  -->

<p>The relation <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-338" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1000.61em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-339"><span class="mi" id="MathJax-Span-340" style="font-family: MathJax_Math-italic;">α</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-24">\alpha</script></span> is a
<a href="https://en.wikipedia.org/wiki/Dependency_graph">dependency graph</a> among
variables. Thus, <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-341" style="width: 2.064em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1001.69em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-342"><span class="mi" id="MathJax-Span-343" style="font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-344" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-345" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-346" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-25">\alpha(i)</script></span> is the list of <em>incoming</em> edges to node <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-347" style="width: 0.377em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.33em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.502em, 1000.28em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-348"><span class="mi" id="MathJax-Span-349" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.872em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-26">i</script></span> and
<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-350" style="width: 10.075em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.67em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1008.62em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-351"><span class="mi" id="MathJax-Span-352" style="font-family: MathJax_Math-italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-353" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-354" style="font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-355" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-356" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mo" id="MathJax-Span-357" style="font-family: MathJax_Main; padding-left: 0.283em;">{</span><span class="mi" id="MathJax-Span-358" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-359" style="font-family: MathJax_Main; padding-left: 0.283em;">:</span><span class="mi" id="MathJax-Span-360" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">j</span><span class="mo" id="MathJax-Span-361" style="font-family: MathJax_Main; padding-left: 0.283em;">∈</span><span class="mi" id="MathJax-Span-362" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">α</span><span class="mo" id="MathJax-Span-363" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-364" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-365" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-366" style="font-family: MathJax_Main;">}</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo><mo>=</mo><mo fence="false" stretchy="false">{</mo><mi>i</mi><mo>:</mo><mi>j</mi><mo>∈</mo><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-27">\beta(j) = \{ i: j \in \alpha(i) \}</script></span> is the set of <em>outgoing</em> edges. For now,
we'll assume that the dependency graph given by <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-367" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1000.61em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-368"><span class="mi" id="MathJax-Span-369" style="font-family: MathJax_Math-italic;">α</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-28">\alpha</script></span> is ① acyclic: no <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-370" style="width: 0.939em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1000.8em, 2.579em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-371"><span class="msubsup" id="MathJax-Span-372"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-373" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-374" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.215em; border-left: 0px solid; width: 0px; height: 0.818em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>z</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-29">z_i</script></span>
can transitively depend on itself.  ② single-assignment: each <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-375" style="width: 0.939em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1000.8em, 2.579em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-376"><span class="msubsup" id="MathJax-Span-377"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-378" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-379" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.215em; border-left: 0px solid; width: 0px; height: 0.818em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>z</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-30">z_i</script></span> appears on
the left-hand side of <em>exactly one</em> equation.  We'll discuss relaxing these
assumptions in <a href="#lagrange-backprop-generalization">§ Generalizations</a>.</p>
<p>The standard way to solve a constrained optimization is to use the method
Lagrange multipliers, which converts a <em>constrained</em> optimization problem into
an <em>unconstrained</em> problem with a few more variables <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-380" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.66em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-381"><span class="mi" id="MathJax-Span-382" style="font-family: MathJax_Math-bold-italic;">λ</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.927em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">λ</mi></math></span></span><script type="math/tex" id="MathJax-Element-31">\boldsymbol{\lambda}</script></span> (one
per <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-383" style="width: 1.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1000.89em, 2.579em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-384"><span class="msubsup" id="MathJax-Span-385"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.52em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-386" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-387" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.215em; border-left: 0px solid; width: 0px; height: 0.818em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-32">x_i</script></span> constraint), called Lagrange multipliers.</p>
<h4>The Lagrangian</h4>
<p>To handle constraints, let's dig up a tool from our calculus class,
<a href="https://en.wikipedia.org/wiki/Lagrange_multiplier">the method of Lagrange multipliers</a>,
which converts a <em>constrained</em> optimization problem into an <em>unconstrained</em>
one. The unconstrained version is called "the Lagrangian" of the constrained
problem. Here is its form for our task,</p>
<div class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;z&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-388" style="width: 20.992em; display: inline-block;"><span style="display: inline-block; position: relative; width: 18.087em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(0.658em, 1017.99em, 3.704em, -999.998em); top: -2.34em; left: 0em;"><span class="mrow" id="MathJax-Span-389"><span class="texatom" id="MathJax-Span-390"><span class="mrow" id="MathJax-Span-391"><span class="mi" id="MathJax-Span-392" style="font-family: MathJax_Caligraphic;">L</span></span></span><span class="mrow" id="MathJax-Span-393" style="padding-left: 0.19em;"><span class="mo" id="MathJax-Span-394" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-395"><span class="mi" id="MathJax-Span-396" style="font-family: MathJax_Math-bold-italic;">x</span><span class="mo" id="MathJax-Span-397" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-398" style="font-family: MathJax_Math-bold-italic; padding-left: 0.19em;">z</span><span class="mo" id="MathJax-Span-399" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-400" style="font-family: MathJax_Math-bold-italic; padding-left: 0.19em;">λ</span></span><span class="mo" id="MathJax-Span-401" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-402" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="msubsup" id="MathJax-Span-403" style="padding-left: 0.283em;"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-404" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-405" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-406" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="munderover" id="MathJax-Span-407" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 1.455em; height: 0px;"><span style="position: absolute; clip: rect(2.907em, 1001.41em, 4.594em, -999.998em); top: -3.98em; left: 0em;"><span class="mo" id="MathJax-Span-408" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.376em, 1001.08em, 4.219em, -999.998em); top: -2.902em; left: 0.143em;"><span class="texatom" id="MathJax-Span-409"><span class="mrow" id="MathJax-Span-410"><span class="mi" id="MathJax-Span-411" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-412" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-413" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.423em, 1000.42em, 4.125em, -999.998em); top: -5.151em; left: 0.518em;"><span class="mi" id="MathJax-Span-414" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-415" style="padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-416" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-417" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-418" style="font-family: MathJax_Main; padding-left: 0.237em;">⋅</span><span class="mrow" id="MathJax-Span-419" style="padding-left: 0.237em;"><span class="mo" id="MathJax-Span-420" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">(</span></span><span class="mrow" id="MathJax-Span-421"><span class="msubsup" id="MathJax-Span-422"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-423" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-424" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-425" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="msubsup" id="MathJax-Span-426" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-427" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-428" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-429" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-430"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-431" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-432"><span class="mrow" id="MathJax-Span-433"><span class="mi" id="MathJax-Span-434" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-435" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-436" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-437" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-438" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-439" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">)</span></span></span><span class="mo" id="MathJax-Span-440" style="font-family: MathJax_Main; padding-left: 0.19em;">.</span></span><span style="display: inline-block; width: 0px; height: 2.345em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.465em; border-left: 0px solid; width: 0px; height: 3.318em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow><mrow><mo>(</mo><mrow><mi mathvariant="bold-italic">x</mi><mo>,</mo><mi mathvariant="bold-italic">z</mi><mo>,</mo><mi mathvariant="bold-italic">λ</mi></mrow><mo>)</mo></mrow><mo>=</mo><msub><mi>z</mi><mi>n</mi></msub><mo>−</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>λ</mi><mi>i</mi></msub><mo>⋅</mo><mrow><mo>(</mo><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>−</mo><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mrow><mo>)</mo></mrow><mo>.</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-33">
\mathcal{L}\left(\boldsymbol{x}, \boldsymbol{z}, \boldsymbol{\lambda}\right)
= z_n - \sum_{i=1}^n \lambda_i \cdot \left( z_i - f_i(z_{\alpha(i)}) \right).
</script></div>
<p>Optimizing the Lagrangian amounts to solving the following nonlinear system of
equations, which give necessary, but not sufficient, conditions for optimality,</p>
<div class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;z&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-441" style="width: 8.623em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.405em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1007.31em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-442"><span class="mi" id="MathJax-Span-443" style="font-family: MathJax_Main;">∇</span><span class="texatom" id="MathJax-Span-444"><span class="mrow" id="MathJax-Span-445"><span class="mi" id="MathJax-Span-446" style="font-family: MathJax_Caligraphic;">L</span></span></span><span class="mrow" id="MathJax-Span-447" style="padding-left: 0.19em;"><span class="mo" id="MathJax-Span-448" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-449"><span class="mi" id="MathJax-Span-450" style="font-family: MathJax_Math-bold-italic;">x</span><span class="mo" id="MathJax-Span-451" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-452" style="font-family: MathJax_Math-bold-italic; padding-left: 0.19em;">z</span><span class="mo" id="MathJax-Span-453" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-454" style="font-family: MathJax_Math-bold-italic; padding-left: 0.19em;">λ</span></span><span class="mo" id="MathJax-Span-455" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-456" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mn" id="MathJax-Span-457" style="font-family: MathJax_Main; padding-left: 0.283em;">0.</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow><mrow><mo>(</mo><mrow><mi mathvariant="bold-italic">x</mi><mo>,</mo><mi mathvariant="bold-italic">z</mi><mo>,</mo><mi mathvariant="bold-italic">λ</mi></mrow><mo>)</mo></mrow><mo>=</mo><mn>0.</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-34">
\nabla \mathcal{L}\left(\boldsymbol{x}, \boldsymbol{z}, \boldsymbol{\lambda}\right) = 0.
</script></div>
<p>Let's look a little closer at the Lagrangian conditions by breaking up the
system of equations into salient parts, corresponding to which variable types
are affected.</p>
<p><strong>Intermediate variables</strong> (<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-458" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.565em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.689em, 1000.57em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-459"><span class="mi" id="MathJax-Span-460" style="font-family: MathJax_Math-bold-italic;">z</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">z</mi></math></span></span><script type="math/tex" id="MathJax-Element-35">\boldsymbol{z}</script></span>): Optimizing the
multipliers—i.e., setting the gradient of Lagrangian
w.r.t. <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-461" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.66em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-462"><span class="mi" id="MathJax-Span-463" style="font-family: MathJax_Math-bold-italic;">λ</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.927em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">λ</mi></math></span></span><script type="math/tex" id="MathJax-Element-36">\boldsymbol{\lambda}</script></span> to zero—ensures that the constraints on
intermediate variables are satisfied.</p>
<div class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right center left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0 thickmathspace&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x21D4;&lt;/mo&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-464" style="width: 23.334em; display: inline-block;"><span style="display: inline-block; position: relative; width: 20.102em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.314em, 1019.82em, 2.767em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-465"><span class="mtable" id="MathJax-Span-466" style="padding-right: 0.19em; padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 19.727em; height: 0px;"><span style="position: absolute; clip: rect(3.048em, 1019.63em, 4.453em, -999.998em); top: -3.98em; left: 0em;"><span style="display: inline-block; position: relative; width: 19.727em; height: 0px;"><span style="position: absolute; clip: rect(3.095em, 1019.63em, 4.5em, -999.998em); top: -4.027em; right: 0em;"><span class="mtd" id="MathJax-Span-467"><span class="mrow" id="MathJax-Span-468"><span class="msubsup" id="MathJax-Span-469"><span style="display: inline-block; position: relative; width: 1.361em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.8em, 4.172em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-470" style="font-family: MathJax_Main;">∇</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.846em;"><span class="texatom" id="MathJax-Span-471"><span class="mrow" id="MathJax-Span-472"><span class="mspace" id="MathJax-Span-473" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span class="msubsup" id="MathJax-Span-474"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px;"><span style="position: absolute; clip: rect(3.376em, 1000.38em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-475" style="font-size: 70.7%; font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.886em; left: 0.424em;"><span class="mi" id="MathJax-Span-476" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="texatom" id="MathJax-Span-477"><span class="mrow" id="MathJax-Span-478"><span class="mi" id="MathJax-Span-479" style="font-family: MathJax_Caligraphic;">L</span></span></span><span class="mo" id="MathJax-Span-480" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="msubsup" id="MathJax-Span-481" style="padding-left: 0.283em;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-482" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-483" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-484" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="msubsup" id="MathJax-Span-485" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-486" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-487" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-488" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-489"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-490" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-491"><span class="mrow" id="MathJax-Span-492"><span class="mi" id="MathJax-Span-493" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-494" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-495" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-496" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-497" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-498" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mn" id="MathJax-Span-499" style="font-family: MathJax_Main; padding-left: 0.283em;">0</span><span class="mspace" id="MathJax-Span-500" style="height: 0em; vertical-align: 0em; width: 0.986em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-501" style="font-family: MathJax_Main; padding-left: 0.283em;">⇔</span><span class="mspace" id="MathJax-Span-502" style="height: 0em; vertical-align: 0em; width: 0.986em; display: inline-block; overflow: hidden;"></span><span class="msubsup" id="MathJax-Span-503" style="padding-left: 0.283em;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-504" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-505" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-506" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="msubsup" id="MathJax-Span-507" style="padding-left: 0.283em;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-508" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-509" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-510" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-511"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-512" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-513"><span class="mrow" id="MathJax-Span-514"><span class="mi" id="MathJax-Span-515" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-516" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-517" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-518" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-519" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.432em; border-left: 0px solid; width: 0px; height: 1.47em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right center left" rowspacing="3pt" columnspacing="0 thickmathspace" displaystyle="true"><mtr><mtd><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mspace width="negativethinmathspace"></mspace><msub><mi>λ</mi><mi>i</mi></msub></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow><mo>=</mo><msub><mi>z</mi><mi>i</mi></msub><mo>−</mo><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn><mspace width="1em"></mspace><mo stretchy="false">⇔</mo><mspace width="1em"></mspace><msub><mi>z</mi><mi>i</mi></msub><mo>=</mo><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-37">
\begin{eqnarray*}
\nabla_{\! \lambda_i} \mathcal{L}
= z_i - f_i(z_{\alpha(i)}) = 0
\quad\Leftrightarrow\quad z_i = f_i(z_{\alpha(i)})
\end{eqnarray*}
</script></div>
<p>We can use forward propagation to satisfy these equations, which we may regard
as a block-coordinate step in the context of optimizing the <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-520" style="width: 0.846em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.705em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.66em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-521"><span class="texatom" id="MathJax-Span-522"><span class="mrow" id="MathJax-Span-523"><span class="mi" id="MathJax-Span-524" style="font-family: MathJax_Caligraphic;">L</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.981em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-38">\mathcal{L}</script></span>.</p>
<!--GENERALIZATION:
However, if they are cyclic dependencies we may need to
solve a nonlinear system of equations. (TODO: it's unclear what the more general
cyclic setting is. Perhaps I should having a running example of a cyclic program
and an acyclic program.)
-->

<p><strong>Lagrange multipliers</strong> (<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-525" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.66em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-526"><span class="mi" id="MathJax-Span-527" style="font-family: MathJax_Math-bold-italic;">λ</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.927em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">λ</mi></math></span></span><script type="math/tex" id="MathJax-Element-39">\boldsymbol{\lambda}</script></span>, excluding <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-528" style="width: 1.267em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.08em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1001.08em, 2.579em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-529"><span class="msubsup" id="MathJax-Span-530"><span style="display: inline-block; position: relative; width: 1.08em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-531" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-532" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.215em; border-left: 0px solid; width: 0px; height: 1.09em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>λ</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-40">\lambda_n</script></span>):
  Setting the gradient of the <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-533" style="width: 0.846em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.705em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.66em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-534"><span class="texatom" id="MathJax-Span-535"><span class="mrow" id="MathJax-Span-536"><span class="mi" id="MathJax-Span-537" style="font-family: MathJax_Caligraphic;">L</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.981em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-41">\mathcal{L}</script></span> w.r.t. the intermediate variables
  equal to zeros tells us what to do with the intermediate multipliers.</p>
<div class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right center left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0 thickmathspace&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;mrow&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;mrow&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;mrow&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;mrow&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x21D5;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd /&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-538" style="width: 25.115em; display: inline-block;"><span style="display: inline-block; position: relative; width: 21.648em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(-7.494em, 1021.23em, 11.575em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-539"><span class="mtable" id="MathJax-Span-540" style="padding-right: 0.19em; padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 21.273em; height: 0px;"><span style="position: absolute; clip: rect(8.857em, 1000.94em, 26.661em, -999.998em); top: -18.504em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.939em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.47em, 4.125em, -999.998em); top: -12.835em; right: 0em;"><span class="mtd" id="MathJax-Span-541"><span class="mrow" id="MathJax-Span-542"><span class="mn" id="MathJax-Span-543" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -10.399em; right: 0em;"><span class="mtd" id="MathJax-Span-561"><span class="mrow" id="MathJax-Span-562"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -7.307em; right: 0em;"><span class="mtd" id="MathJax-Span-619"><span class="mrow" id="MathJax-Span-620"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -4.074em; right: 0em;"><span class="mtd" id="MathJax-Span-673"><span class="mrow" id="MathJax-Span-674"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -0.935em; right: 0em;"><span class="mtd" id="MathJax-Span-755"><span class="mrow" id="MathJax-Span-756"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: 1.595em; right: 0em;"><span class="mtd" id="MathJax-Span-803"><span class="mrow" id="MathJax-Span-804"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1000.94em, 4.406em, -999.998em); top: 3.75em; right: 0em;"><span class="mtd" id="MathJax-Span-811"><span class="mrow" id="MathJax-Span-812"><span class="msubsup" id="MathJax-Span-813"><span style="display: inline-block; position: relative; width: 0.939em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-814" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-815" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 18.509em;"></span></span><span style="position: absolute; clip: rect(8.576em, 1000.99em, 25.771em, -999.998em); top: -17.895em; left: 0.939em;"><span style="display: inline-block; position: relative; width: 1.08em; height: 0px;"><span style="position: absolute; clip: rect(3.469em, 1000.99em, 4.125em, -999.998em); top: -12.835em; left: 50%; margin-left: -0.513em;"><span class="mtd" id="MathJax-Span-544"><span class="mrow" id="MathJax-Span-545"><span class="mi" id="MathJax-Span-546"></span><span class="mo" id="MathJax-Span-547" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.469em, 1000.99em, 4.125em, -999.998em); top: -10.399em; left: 50%; margin-left: -0.513em;"><span class="mtd" id="MathJax-Span-563"><span class="mrow" id="MathJax-Span-564"><span class="mi" id="MathJax-Span-565"></span><span class="mo" id="MathJax-Span-566" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.469em, 1000.99em, 4.125em, -999.998em); top: -7.307em; left: 50%; margin-left: -0.513em;"><span class="mtd" id="MathJax-Span-621"><span class="mrow" id="MathJax-Span-622"><span class="mi" id="MathJax-Span-623"></span><span class="mo" id="MathJax-Span-624" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.469em, 1000.99em, 4.125em, -999.998em); top: -4.074em; left: 50%; margin-left: -0.513em;"><span class="mtd" id="MathJax-Span-675"><span class="mrow" id="MathJax-Span-676"><span class="mi" id="MathJax-Span-677"></span><span class="mo" id="MathJax-Span-678" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.469em, 1000.99em, 4.125em, -999.998em); top: -0.935em; left: 50%; margin-left: -0.513em;"><span class="mtd" id="MathJax-Span-757"><span class="mrow" id="MathJax-Span-758"><span class="mi" id="MathJax-Span-759"></span><span class="mo" id="MathJax-Span-760" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.095em, 1000.85em, 4.406em, -999.998em); top: 1.595em; left: 50%; margin-left: -0.466em;"><span class="mtd" id="MathJax-Span-805"><span class="mrow" id="MathJax-Span-806"><span class="mi" id="MathJax-Span-807"></span><span class="mo" id="MathJax-Span-808" style="font-family: MathJax_Main; padding-left: 0.283em;">⇕</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.469em, 1000.99em, 4.125em, -999.998em); top: 3.75em; left: 50%; margin-left: -0.513em;"><span class="mtd" id="MathJax-Span-816"><span class="mrow" id="MathJax-Span-817"><span class="mi" id="MathJax-Span-818"></span><span class="mo" id="MathJax-Span-819" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 17.9em;"></span></span><span style="position: absolute; clip: rect(9.982em, 1018.74em, 28.957em, -999.998em); top: -19.675em; left: 2.298em;"><span style="display: inline-block; position: relative; width: 18.977em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1001.97em, 4.5em, -999.998em); top: -12.835em; left: 0em;"><span class="mtd" id="MathJax-Span-548"><span class="mrow" id="MathJax-Span-549"><span class="msubsup" id="MathJax-Span-550"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.8em, 4.172em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-551" style="font-family: MathJax_Main;">∇</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.846em;"><span class="texatom" id="MathJax-Span-552"><span class="mrow" id="MathJax-Span-553"><span class="mspace" id="MathJax-Span-554" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span class="msubsup" id="MathJax-Span-555"><span style="display: inline-block; position: relative; width: 0.611em; height: 0px;"><span style="position: absolute; clip: rect(3.516em, 1000.33em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-556" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.886em; left: 0.33em;"><span class="mi" id="MathJax-Span-557" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="texatom" id="MathJax-Span-558"><span class="mrow" id="MathJax-Span-559"><span class="mi" id="MathJax-Span-560" style="font-family: MathJax_Caligraphic;">L</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(2.111em, 1014.06em, 5.39em, -999.998em); top: -10.399em; left: 0em;"><span class="mtd" id="MathJax-Span-567"><span class="mrow" id="MathJax-Span-568"><span class="msubsup" id="MathJax-Span-569"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.8em, 4.172em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-570" style="font-family: MathJax_Main;">∇</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.846em;"><span class="texatom" id="MathJax-Span-571"><span class="mrow" id="MathJax-Span-572"><span class="mspace" id="MathJax-Span-573" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span class="msubsup" id="MathJax-Span-574"><span style="display: inline-block; position: relative; width: 0.611em; height: 0px;"><span style="position: absolute; clip: rect(3.516em, 1000.33em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-575" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.886em; left: 0.33em;"><span class="mi" id="MathJax-Span-576" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mspace" id="MathJax-Span-577" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"></span><span class="mrow" id="MathJax-Span-578" style="padding-left: 0.19em;"><span class="mo" id="MathJax-Span-579" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">[</span></span><span class="mrow" id="MathJax-Span-580"><span class="msubsup" id="MathJax-Span-581"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-582" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-583" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-584" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="munderover" id="MathJax-Span-585" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 1.455em; height: 0px;"><span style="position: absolute; clip: rect(2.907em, 1001.41em, 4.594em, -999.998em); top: -3.98em; left: 0em;"><span class="mo" id="MathJax-Span-586" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.376em, 1001.08em, 4.219em, -999.998em); top: -2.902em; left: 0.143em;"><span class="texatom" id="MathJax-Span-587"><span class="mrow" id="MathJax-Span-588"><span class="mi" id="MathJax-Span-589" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-590" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-591" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.423em, 1000.42em, 4.125em, -999.998em); top: -5.151em; left: 0.518em;"><span class="mi" id="MathJax-Span-592" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-593" style="padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-594" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-595" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-596" style="font-family: MathJax_Main; padding-left: 0.237em;">⋅</span><span class="mrow" id="MathJax-Span-597" style="padding-left: 0.237em;"><span class="mo" id="MathJax-Span-598" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">(</span></span><span class="mrow" id="MathJax-Span-599"><span class="msubsup" id="MathJax-Span-600"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-601" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-602" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-603" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="msubsup" id="MathJax-Span-604" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-605" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-606" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-607" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-608"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-609" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-610"><span class="mrow" id="MathJax-Span-611"><span class="mi" id="MathJax-Span-612" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-613" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-614" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-615" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-616" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-617" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">)</span></span></span></span><span class="mo" id="MathJax-Span-618" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">]</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(2.298em, 1012.09em, 5.343em, -999.998em); top: -7.307em; left: 0em;"><span class="mtd" id="MathJax-Span-625"><span class="mrow" id="MathJax-Span-626"><span class="mi" id="MathJax-Span-627"></span><span class="mo" id="MathJax-Span-628" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="munderover" id="MathJax-Span-629" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 1.455em; height: 0px;"><span style="position: absolute; clip: rect(2.907em, 1001.41em, 4.594em, -999.998em); top: -3.98em; left: 0em;"><span class="mo" id="MathJax-Span-630" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.376em, 1001.08em, 4.219em, -999.998em); top: -2.902em; left: 0.143em;"><span class="texatom" id="MathJax-Span-631"><span class="mrow" id="MathJax-Span-632"><span class="mi" id="MathJax-Span-633" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-634" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-635" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.423em, 1000.42em, 4.125em, -999.998em); top: -5.151em; left: 0.518em;"><span class="mi" id="MathJax-Span-636" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-637" style="padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-638" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-639" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-640"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.8em, 4.172em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-641" style="font-family: MathJax_Main;">∇</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.846em;"><span class="texatom" id="MathJax-Span-642"><span class="mrow" id="MathJax-Span-643"><span class="mspace" id="MathJax-Span-644" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span class="msubsup" id="MathJax-Span-645"><span style="display: inline-block; position: relative; width: 0.611em; height: 0px;"><span style="position: absolute; clip: rect(3.516em, 1000.33em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-646" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.886em; left: 0.33em;"><span class="mi" id="MathJax-Span-647" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mspace" id="MathJax-Span-648" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"></span><span class="mrow" id="MathJax-Span-649" style="padding-left: 0.19em;"><span class="mo" id="MathJax-Span-650" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">[</span></span><span class="mrow" id="MathJax-Span-651"><span class="mo" id="MathJax-Span-652" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">(</span></span><span class="mrow" id="MathJax-Span-653"><span class="msubsup" id="MathJax-Span-654"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-655" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-656" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-657" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="msubsup" id="MathJax-Span-658" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-659" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-660" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-661" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-662"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-663" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-664"><span class="mrow" id="MathJax-Span-665"><span class="mi" id="MathJax-Span-666" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-667" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-668" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-669" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-670" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-671" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">)</span></span></span><span class="mo" id="MathJax-Span-672" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">]</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(2.111em, 1018.74em, 5.39em, -999.998em); top: -4.074em; left: 0em;"><span class="mtd" id="MathJax-Span-679"><span class="mrow" id="MathJax-Span-680"><span class="mi" id="MathJax-Span-681"></span><span class="mo" id="MathJax-Span-682" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="mrow" id="MathJax-Span-683" style="padding-left: 0.237em;"><span class="mo" id="MathJax-Span-684" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">(</span></span><span class="mrow" id="MathJax-Span-685"><span class="munderover" id="MathJax-Span-686"><span style="display: inline-block; position: relative; width: 1.455em; height: 0px;"><span style="position: absolute; clip: rect(2.907em, 1001.41em, 4.594em, -999.998em); top: -3.98em; left: 0em;"><span class="mo" id="MathJax-Span-687" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.376em, 1001.08em, 4.219em, -999.998em); top: -2.902em; left: 0.143em;"><span class="texatom" id="MathJax-Span-688"><span class="mrow" id="MathJax-Span-689"><span class="mi" id="MathJax-Span-690" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-691" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-692" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.423em, 1000.42em, 4.125em, -999.998em); top: -5.151em; left: 0.518em;"><span class="mi" id="MathJax-Span-693" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-694" style="padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-695" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-696" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-697"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.8em, 4.172em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-698" style="font-family: MathJax_Main;">∇</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.846em;"><span class="texatom" id="MathJax-Span-699"><span class="mrow" id="MathJax-Span-700"><span class="mspace" id="MathJax-Span-701" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span class="msubsup" id="MathJax-Span-702"><span style="display: inline-block; position: relative; width: 0.611em; height: 0px;"><span style="position: absolute; clip: rect(3.516em, 1000.33em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-703" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.886em; left: 0.33em;"><span class="mi" id="MathJax-Span-704" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mspace" id="MathJax-Span-705" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"></span><span class="mrow" id="MathJax-Span-706" style="padding-left: 0.19em;"><span class="mo" id="MathJax-Span-707" style="font-family: MathJax_Main;">[</span><span class="msubsup" id="MathJax-Span-708"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-709" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-710" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-711" style="font-family: MathJax_Main;">]</span></span></span><span class="mo" id="MathJax-Span-712" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">)</span></span></span><span class="mo" id="MathJax-Span-713" style="font-family: MathJax_Main; padding-left: 0.237em;">+</span><span class="mrow" id="MathJax-Span-714" style="padding-left: 0.237em;"><span class="mo" id="MathJax-Span-715" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">(</span></span><span class="mrow" id="MathJax-Span-716"><span class="munderover" id="MathJax-Span-717"><span style="display: inline-block; position: relative; width: 1.455em; height: 0px;"><span style="position: absolute; clip: rect(2.907em, 1001.41em, 4.594em, -999.998em); top: -3.98em; left: 0em;"><span class="mo" id="MathJax-Span-718" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.376em, 1001.08em, 4.219em, -999.998em); top: -2.902em; left: 0.143em;"><span class="texatom" id="MathJax-Span-719"><span class="mrow" id="MathJax-Span-720"><span class="mi" id="MathJax-Span-721" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-722" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-723" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.423em, 1000.42em, 4.125em, -999.998em); top: -5.151em; left: 0.518em;"><span class="mi" id="MathJax-Span-724" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-725" style="padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-726" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-727" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-728"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.8em, 4.172em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-729" style="font-family: MathJax_Main;">∇</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.846em;"><span class="texatom" id="MathJax-Span-730"><span class="mrow" id="MathJax-Span-731"><span class="mspace" id="MathJax-Span-732" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span class="msubsup" id="MathJax-Span-733"><span style="display: inline-block; position: relative; width: 0.611em; height: 0px;"><span style="position: absolute; clip: rect(3.516em, 1000.33em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-734" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.886em; left: 0.33em;"><span class="mi" id="MathJax-Span-735" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mspace" id="MathJax-Span-736" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"></span><span class="mrow" id="MathJax-Span-737" style="padding-left: 0.19em;"><span class="mo" id="MathJax-Span-738" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">[</span></span><span class="mrow" id="MathJax-Span-739"><span class="msubsup" id="MathJax-Span-740"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-741" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-742" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-743" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-744"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-745" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-746"><span class="mrow" id="MathJax-Span-747"><span class="mi" id="MathJax-Span-748" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-749" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-750" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-751" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-752" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-753" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">]</span></span></span></span><span class="mo" id="MathJax-Span-754" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(2.251em, 1010.83em, 5.531em, -999.998em); top: -0.935em; left: 0em;"><span class="mtd" id="MathJax-Span-761"><span class="mrow" id="MathJax-Span-762"><span class="mi" id="MathJax-Span-763"></span><span class="mo" id="MathJax-Span-764" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="msubsup" id="MathJax-Span-765" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 0.939em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-766" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-767" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-768" style="font-family: MathJax_Main; padding-left: 0.237em;">+</span><span class="munderover" id="MathJax-Span-769" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 1.97em; height: 0px;"><span style="position: absolute; clip: rect(2.907em, 1001.41em, 4.594em, -999.998em); top: -3.98em; left: 0.283em;"><span class="mo" id="MathJax-Span-770" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.329em, 1001.88em, 4.406em, -999.998em); top: -2.856em; left: 0em;"><span class="texatom" id="MathJax-Span-771"><span class="mrow" id="MathJax-Span-772"><span class="mi" id="MathJax-Span-773" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-774" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-775" style="font-size: 70.7%; font-family: MathJax_Math-italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-776" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-777" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-778" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-779" style="padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-780" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-781" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-782"><span style="display: inline-block; position: relative; width: 4.078em; height: 0px; margin-right: 0.143em; margin-left: 0.143em;"><span style="position: absolute; clip: rect(3.095em, 1003.84em, 4.5em, -999.998em); top: -4.777em; left: 50%; margin-left: -1.965em;"><span class="mrow" id="MathJax-Span-783"><span class="mi" id="MathJax-Span-784" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="msubsup" id="MathJax-Span-785"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-786" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-787" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-788" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-789"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-790" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-791"><span class="mrow" id="MathJax-Span-792"><span class="mi" id="MathJax-Span-793" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-794" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-795" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-796" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-797" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1001.41em, 4.406em, -999.998em); top: -3.277em; left: 50%; margin-left: -0.7em;"><span class="mrow" id="MathJax-Span-798"><span class="mi" id="MathJax-Span-799" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="msubsup" id="MathJax-Span-800"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-801" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-802" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(0.893em, 1004.08em, 1.22em, -999.998em); top: -1.31em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.078em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.08em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: 1.595em; left: 0em;"><span class="mtd" id="MathJax-Span-809"><span class="mrow" id="MathJax-Span-810"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(2.251em, 1007.54em, 5.531em, -999.998em); top: 3.75em; left: 0em;"><span class="mtd" id="MathJax-Span-820"><span class="mrow" id="MathJax-Span-821"><span class="mi" id="MathJax-Span-822"></span><span class="munderover" id="MathJax-Span-823" style="padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 1.97em; height: 0px;"><span style="position: absolute; clip: rect(2.907em, 1001.41em, 4.594em, -999.998em); top: -3.98em; left: 0.283em;"><span class="mo" id="MathJax-Span-824" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.329em, 1001.88em, 4.406em, -999.998em); top: -2.856em; left: 0em;"><span class="texatom" id="MathJax-Span-825"><span class="mrow" id="MathJax-Span-826"><span class="mi" id="MathJax-Span-827" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-828" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-829" style="font-size: 70.7%; font-family: MathJax_Math-italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-830" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-831" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-832" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-833" style="padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-834" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-835" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-836"><span style="display: inline-block; position: relative; width: 4.078em; height: 0px; margin-right: 0.143em; margin-left: 0.143em;"><span style="position: absolute; clip: rect(3.095em, 1003.84em, 4.5em, -999.998em); top: -4.777em; left: 50%; margin-left: -1.965em;"><span class="mrow" id="MathJax-Span-837"><span class="mi" id="MathJax-Span-838" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="msubsup" id="MathJax-Span-839"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-840" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-841" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-842" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-843"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-844" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-845"><span class="mrow" id="MathJax-Span-846"><span class="mi" id="MathJax-Span-847" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-848" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-849" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-850" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-851" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1001.41em, 4.406em, -999.998em); top: -3.277em; left: 50%; margin-left: -0.7em;"><span class="mrow" id="MathJax-Span-852"><span class="mi" id="MathJax-Span-853" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="msubsup" id="MathJax-Span-854"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-855" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-856" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(0.893em, 1004.08em, 1.22em, -999.998em); top: -1.31em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.078em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.08em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 19.68em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -10.649em; border-left: 0px solid; width: 0px; height: 21.905em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right center left" rowspacing="3pt" columnspacing="0 thickmathspace" displaystyle="true"><mtr><mtd><mn>0</mn></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mspace width="negativethinmathspace"></mspace><msub><mi>z</mi><mi>j</mi></msub></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mspace width="negativethinmathspace"></mspace><msub><mi>z</mi><mi>j</mi></msub></mrow></msub><mspace width="negativethinmathspace"></mspace><mrow><mo>[</mo><mrow><msub><mi>z</mi><mi>n</mi></msub><mo>−</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>λ</mi><mi>i</mi></msub><mo>⋅</mo><mrow><mo>(</mo><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>−</mo><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mrow><mo>)</mo></mrow></mrow><mo>]</mo></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><mi></mi><mo>−</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>λ</mi><mi>i</mi></msub><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mspace width="negativethinmathspace"></mspace><msub><mi>z</mi><mi>j</mi></msub></mrow></msub><mspace width="negativethinmathspace"></mspace><mrow><mo>[</mo><mrow><mo>(</mo><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>−</mo><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mrow><mo>)</mo></mrow><mo>]</mo></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><mi></mi><mo>−</mo><mrow><mo>(</mo><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>λ</mi><mi>i</mi></msub><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mspace width="negativethinmathspace"></mspace><msub><mi>z</mi><mi>j</mi></msub></mrow></msub><mspace width="negativethinmathspace"></mspace><mrow><mo>[</mo><msub><mi>z</mi><mi>i</mi></msub><mo>]</mo></mrow></mrow><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>λ</mi><mi>i</mi></msub><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mspace width="negativethinmathspace"></mspace><msub><mi>z</mi><mi>j</mi></msub></mrow></msub><mspace width="negativethinmathspace"></mspace><mrow><mo>[</mo><mrow><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mrow><mo>]</mo></mrow></mrow><mo>)</mo></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><mi></mi><mo>−</mo><msub><mi>λ</mi><mi>j</mi></msub><mo>+</mo><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>∈</mo><mi>β</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></munder><msub><mi>λ</mi><mi>i</mi></msub><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>z</mi><mi>j</mi></msub></mrow></mfrac></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo stretchy="false">⇕</mo></mtd><mtd></mtd></mtr><mtr><mtd><msub><mi>λ</mi><mi>j</mi></msub></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><mi></mi><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>∈</mo><mi>β</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></munder><msub><mi>λ</mi><mi>i</mi></msub><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>z</mi><mi>j</mi></msub></mrow></mfrac></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-42">\begin{eqnarray*}
0 &=& \nabla_{\! z_j} \mathcal{L} \\
&=& \nabla_{\! z_j}\! \left[ z_n - \sum_{i=1}^n \lambda_i \cdot \left( z_i - f_i(z_{\alpha(i)}) \right) \right] \\
&=& - \sum_{i=1}^n \lambda_i \nabla_{\! z_j}\! \left[ \left( z_i - f_i(z_{\alpha(i)}) \right) \right] \\
&=& - \left( \sum_{i=1}^n \lambda_i \nabla_{\! z_j}\! \left[ z_i \right] \right) + \left( \sum_{i=1}^n \lambda_i \nabla_{\! z_j}\! \left[ f_i(z_{\alpha(i)}) \right] \right) \\
&=& - \lambda_j + \sum_{i \in \beta(j)} \lambda_i \frac{\partial f_i(z_{\alpha(i)})}{\partial z_j} \\
&\Updownarrow& \\
\lambda_j &=& \sum_{i \in \beta(j)} \lambda_i \frac{\partial f_i(z_{\alpha(i)})}{\partial z_j} \\
\end{eqnarray*}</script></div>
<p>Clearly, <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-857" style="width: 5.812em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.015em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(0.986em, 1004.97em, 3.048em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-858"><span class="mfrac" id="MathJax-Span-859"><span style="display: inline-block; position: relative; width: 2.907em; height: 0px; margin-right: 0.143em; margin-left: 0.143em;"><span style="position: absolute; clip: rect(3.329em, 1002.72em, 4.36em, -999.998em); top: -4.636em; left: 50%; margin-left: -1.403em;"><span class="mrow" id="MathJax-Span-860"><span class="mi" id="MathJax-Span-861" style="font-size: 70.7%; font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="msubsup" id="MathJax-Span-862"><span style="display: inline-block; position: relative; width: 0.565em; height: 0px;"><span style="position: absolute; clip: rect(3.329em, 1000.38em, 4.266em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-863" style="font-size: 70.7%; font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.33em;"><span class="mi" id="MathJax-Span-864" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-865" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-866"><span style="display: inline-block; position: relative; width: 1.267em; height: 0px;"><span style="position: absolute; clip: rect(3.516em, 1000.33em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-867" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.33em;"><span class="texatom" id="MathJax-Span-868"><span class="mrow" id="MathJax-Span-869"><span class="mi" id="MathJax-Span-870" style="font-size: 50%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-871" style="font-size: 50%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-872" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-873" style="font-size: 50%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-874" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.329em, 1000.99em, 4.313em, -999.998em); top: -3.558em; left: 50%; margin-left: -0.513em;"><span class="mrow" id="MathJax-Span-875"><span class="mi" id="MathJax-Span-876" style="font-size: 70.7%; font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="msubsup" id="MathJax-Span-877"><span style="display: inline-block; position: relative; width: 0.611em; height: 0px;"><span style="position: absolute; clip: rect(3.516em, 1000.33em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-878" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.886em; left: 0.33em;"><span class="mi" id="MathJax-Span-879" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(0.893em, 1002.91em, 1.22em, -999.998em); top: -1.31em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.907em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.08em;"></span></span></span></span><span class="mo" id="MathJax-Span-880" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mn" id="MathJax-Span-881" style="font-family: MathJax_Main; padding-left: 0.283em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.758em; border-left: 0px solid; width: 0px; height: 2.177em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>z</mi><mi>j</mi></msub></mrow></mfrac><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-43">\frac{\partial f_i(z_{\alpha(i)})}{\partial z_j} = 0</script></span> for <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;&amp;#x2209;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-882" style="width: 3.985em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.423em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1003.33em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-883"><span class="mi" id="MathJax-Span-884" style="font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-885" style="font-family: MathJax_Main; padding-left: 0.283em;">∉</span><span class="mi" id="MathJax-Span-886" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">α</span><span class="mo" id="MathJax-Span-887" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-888" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-889" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi><mo>∉</mo><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-44">j \notin
\alpha(i)</script></span>, which is why the <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-890" style="width: 2.017em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.736em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1001.64em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-891"><span class="mi" id="MathJax-Span-892" style="font-family: MathJax_Math-italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-893" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-894" style="font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-895" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-45">\beta(j)</script></span> notation came in handy. By assumption,
the local derivatives, <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-896" style="width: 3.704em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.188em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(0.986em, 1003.19em, 3.048em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-897"><span class="mfrac" id="MathJax-Span-898"><span style="display: inline-block; position: relative; width: 2.907em; height: 0px; margin-right: 0.143em; margin-left: 0.143em;"><span style="position: absolute; clip: rect(3.329em, 1002.72em, 4.36em, -999.998em); top: -4.636em; left: 50%; margin-left: -1.403em;"><span class="mrow" id="MathJax-Span-899"><span class="mi" id="MathJax-Span-900" style="font-size: 70.7%; font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="msubsup" id="MathJax-Span-901"><span style="display: inline-block; position: relative; width: 0.565em; height: 0px;"><span style="position: absolute; clip: rect(3.329em, 1000.38em, 4.266em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-902" style="font-size: 70.7%; font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.33em;"><span class="mi" id="MathJax-Span-903" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-904" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-905"><span style="display: inline-block; position: relative; width: 1.267em; height: 0px;"><span style="position: absolute; clip: rect(3.516em, 1000.33em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-906" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.33em;"><span class="texatom" id="MathJax-Span-907"><span class="mrow" id="MathJax-Span-908"><span class="mi" id="MathJax-Span-909" style="font-size: 50%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-910" style="font-size: 50%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-911" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-912" style="font-size: 50%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-913" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.329em, 1000.99em, 4.313em, -999.998em); top: -3.558em; left: 50%; margin-left: -0.513em;"><span class="mrow" id="MathJax-Span-914"><span class="mi" id="MathJax-Span-915" style="font-size: 70.7%; font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="msubsup" id="MathJax-Span-916"><span style="display: inline-block; position: relative; width: 0.611em; height: 0px;"><span style="position: absolute; clip: rect(3.516em, 1000.33em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-917" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.886em; left: 0.33em;"><span class="mi" id="MathJax-Span-918" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(0.893em, 1002.91em, 1.22em, -999.998em); top: -1.31em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.907em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.08em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.758em; border-left: 0px solid; width: 0px; height: 2.177em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>z</mi><mi>j</mi></msub></mrow></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-46">\frac{\partial f_i(z_{\alpha(i)})}{\partial z_j}</script></span> for <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-919" style="width: 3.985em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.423em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1003.33em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-920"><span class="mi" id="MathJax-Span-921" style="font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-922" style="font-family: MathJax_Main; padding-left: 0.283em;">∈</span><span class="mi" id="MathJax-Span-923" style="font-family: MathJax_Math-italic; padding-left: 0.283em;">α</span><span class="mo" id="MathJax-Span-924" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-925" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-926" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi><mo>∈</mo><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-47">j
\in \alpha(i)</script></span>, are easy to calculate—we don't even need the chain rule to
compute them because they are simple function applications without
composition. Similar to the equations for <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-927" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.565em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.689em, 1000.57em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-928"><span class="mi" id="MathJax-Span-929" style="font-family: MathJax_Math-bold-italic;">z</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">z</mi></math></span></span><script type="math/tex" id="MathJax-Element-48">\boldsymbol{z}</script></span>, solving this linear
system is another block-coordinate step.</p>
<p><em>Key observation</em>: The last equation for <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-930" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.939em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.94em, 2.72em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-931"><span class="msubsup" id="MathJax-Span-932"><span style="display: inline-block; position: relative; width: 0.939em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-933" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-934" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.378em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>λ</mi><mi>j</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-49">\lambda_j</script></span> should look very familiar:
It is exactly the equation used in backpropagation! It says that we sum
<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-935" style="width: 1.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.89em, 2.579em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-936"><span class="msubsup" id="MathJax-Span-937"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-938" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-939" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.215em; border-left: 0px solid; width: 0px; height: 1.09em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>λ</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-50">\lambda_i</script></span> of nodes that immediately depend on <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-940" style="width: 0.518em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.424em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.502em, 1000.42em, 2.626em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-941"><span class="mi" id="MathJax-Span-942" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.269em; border-left: 0px solid; width: 0px; height: 1.09em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-51">j</script></span> where we scaled each
<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-943" style="width: 1.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.89em, 2.579em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-944"><span class="msubsup" id="MathJax-Span-945"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-946" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-947" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.215em; border-left: 0px solid; width: 0px; height: 1.09em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>λ</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-52">\lambda_i</script></span> by the derivative of the function that directly relates <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-948" style="width: 0.377em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.33em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.502em, 1000.28em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-949"><span class="mi" id="MathJax-Span-950" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.872em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-53">i</script></span> and
<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-951" style="width: 0.518em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.424em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.502em, 1000.42em, 2.626em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-952"><span class="mi" id="MathJax-Span-953" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.269em; border-left: 0px solid; width: 0px; height: 1.09em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-54">j</script></span>. You should think of the scaling as a "unit conversion" from derivatives of
type <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-954" style="width: 0.377em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.33em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.502em, 1000.28em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-955"><span class="mi" id="MathJax-Span-956" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.872em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-55">i</script></span> to derivatives of type <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-957" style="width: 0.518em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.424em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.502em, 1000.42em, 2.626em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-958"><span class="mi" id="MathJax-Span-959" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.269em; border-left: 0px solid; width: 0px; height: 1.09em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-56">j</script></span>.</p>
<p><strong>Output multiplier</strong> (<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-960" style="width: 1.267em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.08em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1001.08em, 2.579em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-961"><span class="msubsup" id="MathJax-Span-962"><span style="display: inline-block; position: relative; width: 1.08em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-963" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-964" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.215em; border-left: 0px solid; width: 0px; height: 1.09em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>λ</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-57">\lambda_n</script></span>): Here we follow the same pattern as for
  intermediate multipliers.</p>
<div class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right center left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0 thickmathspace&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;mrow&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x21D5;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd /&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-965" style="width: 25.162em; display: inline-block;"><span style="display: inline-block; position: relative; width: 21.695em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(-0.935em, 1021.51em, 5.015em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-966"><span class="mtable" id="MathJax-Span-967" style="padding-right: 0.19em; padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 21.32em; height: 0px;"><span style="position: absolute; clip: rect(3.376em, 1001.08em, 8.201em, -999.998em); top: -5.526em; left: 0em;"><span style="display: inline-block; position: relative; width: 1.08em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.47em, 4.125em, -999.998em); top: -5.339em; right: 0em;"><span class="mtd" id="MathJax-Span-968"><span class="mrow" id="MathJax-Span-969"><span class="mn" id="MathJax-Span-970" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -2.949em; right: 0em;"><span class="mtd" id="MathJax-Span-1038"><span class="mrow" id="MathJax-Span-1039"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1001.08em, 4.266em, -999.998em); top: -1.591em; right: 0em;"><span class="mtd" id="MathJax-Span-1046"><span class="mrow" id="MathJax-Span-1047"><span class="msubsup" id="MathJax-Span-1048"><span style="display: inline-block; position: relative; width: 1.08em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1049" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-1050" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.531em;"></span></span><span style="position: absolute; clip: rect(3.282em, 1000.99em, 7.639em, -999.998em); top: -5.104em; left: 1.08em;"><span style="display: inline-block; position: relative; width: 1.08em; height: 0px;"><span style="position: absolute; clip: rect(3.469em, 1000.99em, 4.125em, -999.998em); top: -5.339em; left: 50%; margin-left: -0.513em;"><span class="mtd" id="MathJax-Span-971"><span class="mrow" id="MathJax-Span-972"><span class="mi" id="MathJax-Span-973"></span><span class="mo" id="MathJax-Span-974" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.095em, 1000.85em, 4.406em, -999.998em); top: -2.949em; left: 50%; margin-left: -0.466em;"><span class="mtd" id="MathJax-Span-1040"><span class="mrow" id="MathJax-Span-1041"><span class="mi" id="MathJax-Span-1042"></span><span class="mo" id="MathJax-Span-1043" style="font-family: MathJax_Main; padding-left: 0.283em;">⇕</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.469em, 1000.99em, 4.125em, -999.998em); top: -1.591em; left: 50%; margin-left: -0.513em;"><span class="mtd" id="MathJax-Span-1051"><span class="mrow" id="MathJax-Span-1052"><span class="mi" id="MathJax-Span-1053"></span><span class="mo" id="MathJax-Span-1054" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.109em;"></span></span><span style="position: absolute; clip: rect(3.235em, 1014.15em, 8.998em, -999.998em); top: -6.463em; left: 2.439em;"><span style="display: inline-block; position: relative; width: 14.433em; height: 0px;"><span style="position: absolute; clip: rect(2.111em, 1014.15em, 5.39em, -999.998em); top: -5.339em; left: 0em;"><span class="mtd" id="MathJax-Span-975"><span class="mrow" id="MathJax-Span-976"><span class="msubsup" id="MathJax-Span-977"><span style="display: inline-block; position: relative; width: 1.408em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.8em, 4.172em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-978" style="font-family: MathJax_Main;">∇</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.846em;"><span class="texatom" id="MathJax-Span-979"><span class="mrow" id="MathJax-Span-980"><span class="mspace" id="MathJax-Span-981" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span class="msubsup" id="MathJax-Span-982"><span style="display: inline-block; position: relative; width: 0.705em; height: 0px;"><span style="position: absolute; clip: rect(3.516em, 1000.33em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-983" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.886em; left: 0.33em;"><span class="mi" id="MathJax-Span-984" style="font-size: 50%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mspace" id="MathJax-Span-985" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"></span><span class="mrow" id="MathJax-Span-986" style="padding-left: 0.19em;"><span class="mo" id="MathJax-Span-987" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">[</span></span><span class="mrow" id="MathJax-Span-988"><span class="msubsup" id="MathJax-Span-989"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-990" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-991" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-992" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="munderover" id="MathJax-Span-993" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 1.455em; height: 0px;"><span style="position: absolute; clip: rect(2.907em, 1001.41em, 4.594em, -999.998em); top: -3.98em; left: 0em;"><span class="mo" id="MathJax-Span-994" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.376em, 1001.08em, 4.219em, -999.998em); top: -2.902em; left: 0.143em;"><span class="texatom" id="MathJax-Span-995"><span class="mrow" id="MathJax-Span-996"><span class="mi" id="MathJax-Span-997" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-998" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-999" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.423em, 1000.42em, 4.125em, -999.998em); top: -5.151em; left: 0.518em;"><span class="mi" id="MathJax-Span-1000" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1001" style="padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1002" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-1003" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-1004" style="font-family: MathJax_Main; padding-left: 0.237em;">⋅</span><span class="mrow" id="MathJax-Span-1005" style="padding-left: 0.237em;"><span class="mo" id="MathJax-Span-1006" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">(</span></span><span class="mrow" id="MathJax-Span-1007"><span class="msubsup" id="MathJax-Span-1008"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1009" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-1010" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-1011" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="msubsup" id="MathJax-Span-1012" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 0.799em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1013" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-1014" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-1015" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1016"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1017" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.793em; left: 0.471em;"><span class="texatom" id="MathJax-Span-1018"><span class="mrow" id="MathJax-Span-1019"><span class="mi" id="MathJax-Span-1020" style="font-size: 70.7%; font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-1021" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1022" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1023" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-1024" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-1025" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">)</span></span></span></span><span class="mo" id="MathJax-Span-1026" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">]</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -2.949em; left: 0em;"><span class="mtd" id="MathJax-Span-1044"><span class="mrow" id="MathJax-Span-1045"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.188em, 1000.42em, 4.125em, -999.998em); top: -1.591em; left: 0em;"><span class="mtd" id="MathJax-Span-1055"><span class="mrow" id="MathJax-Span-1056"><span class="mn" id="MathJax-Span-1057" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.468em;"></span></span><span style="position: absolute; clip: rect(2.158em, 1000.99em, 2.767em, -999.998em); top: -3.98em; left: 17.15em;"><span style="display: inline-block; position: relative; width: 1.08em; height: 0px;"><span style="position: absolute; clip: rect(3.469em, 1000.99em, 4.125em, -999.998em); top: -5.339em; left: 0em;"><span class="mtd" id="MathJax-Span-1027"><span class="mrow" id="MathJax-Span-1028"><span class="mi" id="MathJax-Span-1029"></span><span class="mo" id="MathJax-Span-1030" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(1.83em, 1002.81em, 2.954em, -999.998em); top: -3.98em; left: 18.462em;"><span style="display: inline-block; position: relative; width: 2.813em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1002.81em, 4.266em, -999.998em); top: -5.339em; left: 0em;"><span class="mtd" id="MathJax-Span-1031"><span class="mrow" id="MathJax-Span-1032"><span class="mn" id="MathJax-Span-1033" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1034" style="font-family: MathJax_Main; padding-left: 0.237em;">−</span><span class="msubsup" id="MathJax-Span-1035" style="padding-left: 0.237em;"><span style="display: inline-block; position: relative; width: 1.08em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1036" style="font-family: MathJax_Math-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="mi" id="MathJax-Span-1037" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -3.041em; border-left: 0px solid; width: 0px; height: 6.688em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right center left" rowspacing="3pt" columnspacing="0 thickmathspace" displaystyle="true"><mtr><mtd><mn>0</mn></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mspace width="negativethinmathspace"></mspace><msub><mi>z</mi><mi>n</mi></msub></mrow></msub><mspace width="negativethinmathspace"></mspace><mrow><mo>[</mo><mrow><msub><mi>z</mi><mi>n</mi></msub><mo>−</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>λ</mi><mi>i</mi></msub><mo>⋅</mo><mrow><mo>(</mo><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>−</mo><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mrow class="MJX-TeXAtom-ORD"><mi>α</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mrow><mo>)</mo></mrow></mrow><mo>]</mo></mrow></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><mn>1</mn><mo>−</mo><msub><mi>λ</mi><mi>n</mi></msub></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo stretchy="false">⇕</mo></mtd><mtd></mtd></mtr><mtr><mtd><msub><mi>λ</mi><mi>n</mi></msub></mtd><mtd><mi></mi><mo>=</mo></mtd><mtd><mn>1</mn></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-58">
\begin{eqnarray*}
0 &=& \nabla_{\! z_n}\! \left[ z_n - \sum_{i=1}^n \lambda_i \cdot \left( z_i - f_i(z_{\alpha(i)}) \right) \right] &=& 1 - \lambda_n \\
 &\Updownarrow& \\
 \lambda_n &=& 1
\end{eqnarray*}
</script></div>
<p><strong>Input multipliers</strong> <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1058" style="width: 2.907em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1002.39em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1059"><span class="mo" id="MathJax-Span-1060" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1061"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.66em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1062" style="font-family: MathJax_Math-bold-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.658em;"><span class="texatom" id="MathJax-Span-1063"><span class="mrow" id="MathJax-Span-1064"><span class="mn" id="MathJax-Span-1065" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1066" style="font-size: 70.7%; font-family: MathJax_Main;">:</span><span class="mi" id="MathJax-Span-1067" style="font-size: 70.7%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-1068" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msub><mi mathvariant="bold-italic">λ</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>d</mi></mrow></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-59">(\boldsymbol{\lambda}_{1:d})</script></span>: Our dummy constraints
  gives us <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1069" style="width: 1.97em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1001.69em, 2.579em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1070"><span class="msubsup" id="MathJax-Span-1071"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.66em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1072" style="font-family: MathJax_Math-bold-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.658em;"><span class="texatom" id="MathJax-Span-1073"><span class="mrow" id="MathJax-Span-1074"><span class="mn" id="MathJax-Span-1075" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1076" style="font-size: 70.7%; font-family: MathJax_Main;">:</span><span class="mi" id="MathJax-Span-1077" style="font-size: 70.7%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.215em; border-left: 0px solid; width: 0px; height: 1.09em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi mathvariant="bold-italic">λ</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>d</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-60">\boldsymbol{\lambda}_{1:d}</script></span>, which are conveniently equal to the
  gradient of the function we're optimizing:</p>
<div class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1078" style="width: 7.592em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.515em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1006.42em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1079"><span class="msubsup" id="MathJax-Span-1080"><span style="display: inline-block; position: relative; width: 1.22em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.8em, 4.172em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1081" style="font-family: MathJax_Main;">∇</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.846em;"><span class="texatom" id="MathJax-Span-1082"><span class="mrow" id="MathJax-Span-1083"><span class="mspace" id="MathJax-Span-1084" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span class="mi" id="MathJax-Span-1085" style="font-size: 70.7%; font-family: MathJax_Math-bold-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mi" id="MathJax-Span-1086" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="mo" id="MathJax-Span-1087" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1088" style="font-family: MathJax_Math-bold-italic;">x</span><span class="mo" id="MathJax-Span-1089" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1090" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="msubsup" id="MathJax-Span-1091" style="padding-left: 0.283em;"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.66em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1092" style="font-family: MathJax_Math-bold-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.658em;"><span class="texatom" id="MathJax-Span-1093"><span class="mrow" id="MathJax-Span-1094"><span class="mn" id="MathJax-Span-1095" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1096" style="font-size: 70.7%; font-family: MathJax_Main;">:</span><span class="mi" id="MathJax-Span-1097" style="font-size: 70.7%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-1098" style="font-family: MathJax_Main;">.</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mspace width="negativethinmathspace"></mspace><mi mathvariant="bold-italic">x</mi></mrow></msub><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">x</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi mathvariant="bold-italic">λ</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>d</mi></mrow></msub><mo>.</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-61">
\nabla_{\!\boldsymbol{x}} f(\boldsymbol{x}) = \boldsymbol{\lambda}_{1:d}.
</script></div>
<p>Of course, this interpretation is only precise when ① the constraints are
satisfied (<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1099" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.565em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.689em, 1000.57em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1100"><span class="mi" id="MathJax-Span-1101" style="font-family: MathJax_Math-bold-italic;">z</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">z</mi></math></span></span><script type="math/tex" id="MathJax-Element-62">\boldsymbol{z}</script></span> equations) and ② the linear system on multipliers is
satisfied (<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1102" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.66em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1103"><span class="mi" id="MathJax-Span-1104" style="font-family: MathJax_Math-bold-italic;">λ</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.927em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">λ</mi></math></span></span><script type="math/tex" id="MathJax-Element-63">\boldsymbol{\lambda}</script></span> equations).</p>
<p><strong>Input variables</strong> (<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1105" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.689em, 1000.61em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1106"><span class="mi" id="MathJax-Span-1107" style="font-family: MathJax_Math-bold-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">x</mi></math></span></span><script type="math/tex" id="MathJax-Element-64">\boldsymbol{x}</script></span>): Unfortunately, the there is no
  closed-form solution to how to set <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1108" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.689em, 1000.61em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1109"><span class="mi" id="MathJax-Span-1110" style="font-family: MathJax_Math-bold-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">x</mi></math></span></span><script type="math/tex" id="MathJax-Element-65">\boldsymbol{x}</script></span>. For this we resort to
  something like gradient ascent. Conveniently, <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mspace width=&quot;negativethinmathspace&quot; /&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1111" style="width: 7.264em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.234em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.408em, 1006.23em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1112"><span class="msubsup" id="MathJax-Span-1113"><span style="display: inline-block; position: relative; width: 1.22em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.8em, 4.172em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1114" style="font-family: MathJax_Main;">∇</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.846em;"><span class="texatom" id="MathJax-Span-1115"><span class="mrow" id="MathJax-Span-1116"><span class="mspace" id="MathJax-Span-1117" style="height: 0em; vertical-align: 0em; margin-left: -0.185em;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span class="mi" id="MathJax-Span-1118" style="font-size: 70.7%; font-family: MathJax_Math-bold-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mi" id="MathJax-Span-1119" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.049em;"></span></span><span class="mo" id="MathJax-Span-1120" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1121" style="font-family: MathJax_Math-bold-italic;">x</span><span class="mo" id="MathJax-Span-1122" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1123" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="msubsup" id="MathJax-Span-1124" style="padding-left: 0.283em;"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px;"><span style="position: absolute; clip: rect(3.141em, 1000.66em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1125" style="font-family: MathJax_Math-bold-italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.658em;"><span class="texatom" id="MathJax-Span-1126"><span class="mrow" id="MathJax-Span-1127"><span class="mn" id="MathJax-Span-1128" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1129" style="font-size: 70.7%; font-family: MathJax_Main;">:</span><span class="mi" id="MathJax-Span-1130" style="font-size: 70.7%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mspace width="negativethinmathspace"></mspace><mi mathvariant="bold-italic">x</mi></mrow></msub><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">x</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi mathvariant="bold-italic">λ</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>d</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-66">\nabla_{\!\boldsymbol{x}}
  f(\boldsymbol{x}) = \boldsymbol{\lambda}_{1:d}</script></span>, which we can use to optimize
  <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1131" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.689em, 1000.61em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1132"><span class="mi" id="MathJax-Span-1133" style="font-family: MathJax_Math-bold-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">x</mi></math></span></span><script type="math/tex" id="MathJax-Element-67">\boldsymbol{x}</script></span>!</p>
<div id="lagrange-backprop-generalization"></div>

<h3>Generalizations</h3>
<p>We can think of these equations for <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1134" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.66em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1135"><span class="mi" id="MathJax-Span-1136" style="font-family: MathJax_Math-bold-italic;">λ</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.927em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">λ</mi></math></span></span><script type="math/tex" id="MathJax-Element-68">\boldsymbol{\lambda}</script></span> as a simple <em>linear</em>
system of equations, which we are solving by back-substitution when we use the
backpropagation method. The reason why back-substitution is sufficient for the
linear system (i.e., we don't need a <em>full</em> linear system solver) is that the
dependency graph induced by the <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1137" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1000.61em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1138"><span class="mi" id="MathJax-Span-1139" style="font-family: MathJax_Math-italic;">α</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-69">\alpha</script></span> relation is acyclic. If we had needed a
full linear system solver, the solution would take <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;O&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1140" style="width: 3.048em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.626em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.314em, 1002.53em, 2.673em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1141"><span class="texatom" id="MathJax-Span-1142"><span class="mrow" id="MathJax-Span-1143"><span class="mi" id="MathJax-Span-1144" style="font-family: MathJax_Caligraphic;">O</span></span></span><span class="mo" id="MathJax-Span-1145" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1146"><span style="display: inline-block; position: relative; width: 1.033em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1147" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -4.355em; left: 0.611em;"><span class="mn" id="MathJax-Span-1148" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-1149" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.323em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">O</mi></mrow><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-70">\mathcal{O}(n^3)</script></span> time
instead of linear time, seriously blowing-up our nice runtime!</p>
<p>This connection to linear systems is interesting: It tells us that we can
compute <em>global</em> gradients in cyclic graphs. All we'd need is to run a linear
system solver to stitch together <em>local</em> gradients! That is exactly what the
<a href="https://en.wikipedia.org/wiki/Implicit_function_theorem">implicit function theorem</a>
says!</p>
<p>Cyclic constraints add some expressive powerful to our "constraint language" and
it's interesting that we can still efficiently compute gradients in this
setting. An example of what a general type of cyclic constraint looks like is</p>
<div class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left right left right left right left right left right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;munder&gt;&lt;mtext&gt;argmax&lt;/mtext&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;/munder&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mtext&gt;s.t.&lt;/mtext&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn mathvariant=&quot;bold&quot;&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mtext&gt;and&lt;/mtext&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;z&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;x&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1150" style="width: 7.639em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.562em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(-0.279em, 1006.33em, 4.36em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1151"><span class="mtable" id="MathJax-Span-1152" style="padding-right: 0.19em; padding-left: 0.19em;"><span style="display: inline-block; position: relative; width: 6.187em; height: 0px;"><span style="position: absolute; clip: rect(2.579em, 1000em, 6.234em, -999.998em); top: -4.355em; left: 0em;"><span style="display: inline-block; position: relative; width: 0em; height: 0px;"><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -5.62em; right: 0em;"><span class="mtd" id="MathJax-Span-1153"><span class="mrow" id="MathJax-Span-1154"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -3.605em; right: 0em;"><span class="mtd" id="MathJax-Span-1164"><span class="mrow" id="MathJax-Span-1165"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.844em, 1000em, 4.125em, -999.998em); top: -2.247em; right: 0em;"><span class="mtd" id="MathJax-Span-1176"><span class="mrow" id="MathJax-Span-1177"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.36em;"></span></span><span style="position: absolute; clip: rect(2.767em, 1006.09em, 6.983em, -999.998em); top: -4.964em; left: 0em;"><span style="display: inline-block; position: relative; width: 6.187em; height: 0px;"><span style="position: absolute; clip: rect(3.376em, 1004.41em, 5.015em, -999.998em); top: -5.62em; left: 0em;"><span class="mtd" id="MathJax-Span-1155"><span class="mrow" id="MathJax-Span-1156"><span class="munder" id="MathJax-Span-1157"><span style="display: inline-block; position: relative; width: 3.235em; height: 0px;"><span style="position: absolute; clip: rect(3.376em, 1003.24em, 4.313em, -999.998em); top: -3.98em; left: 0em;"><span class="mtext" id="MathJax-Span-1158" style="font-family: MathJax_Main;">argmax</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.516em, 1000.42em, 4.219em, -999.998em); top: -3.184em; left: 1.408em;"><span class="mi" id="MathJax-Span-1159" style="font-size: 70.7%; font-family: MathJax_Math-bold-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mspace" id="MathJax-Span-1160" style="height: 0em; vertical-align: 0em; width: 0.19em; display: inline-block; overflow: hidden;"></span><span class="msubsup" id="MathJax-Span-1161"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.423em, 1000.47em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1162" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.471em;"><span class="mi" id="MathJax-Span-1163" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.095em, 1006.05em, 4.36em, -999.998em); top: -3.605em; left: 0em;"><span class="mtd" id="MathJax-Span-1166"><span class="mrow" id="MathJax-Span-1167"><span class="mtext" id="MathJax-Span-1168" style="font-family: MathJax_Main;">s.t.</span><span class="mspace" id="MathJax-Span-1169" style="height: 0em; vertical-align: 0em; width: 0.986em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-1170" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1171" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1172" style="font-family: MathJax_Math-bold-italic;">z</span><span class="mo" id="MathJax-Span-1173" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1174" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mn" id="MathJax-Span-1175" style="font-family: MathJax_Main-bold; padding-left: 0.283em;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; clip: rect(3.141em, 1006.09em, 4.266em, -999.998em); top: -2.247em; left: 0em;"><span class="mtd" id="MathJax-Span-1178"><span class="mrow" id="MathJax-Span-1179"><span class="mtext" id="MathJax-Span-1180" style="font-family: MathJax_Main;">and</span><span class="mspace" id="MathJax-Span-1181" style="height: 0em; vertical-align: 0em; width: 0.986em; display: inline-block; overflow: hidden;"></span><span class="msubsup" id="MathJax-Span-1182"><span style="display: inline-block; position: relative; width: 1.548em; height: 0px;"><span style="position: absolute; clip: rect(3.376em, 1000.57em, 4.125em, -999.998em); top: -3.98em; left: 0em;"><span class="mi" id="MathJax-Span-1183" style="font-family: MathJax_Math-bold-italic;">z</span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span><span style="position: absolute; top: -3.839em; left: 0.565em;"><span class="texatom" id="MathJax-Span-1184"><span class="mrow" id="MathJax-Span-1185"><span class="mn" id="MathJax-Span-1186" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1187" style="font-size: 70.7%; font-family: MathJax_Main;">:</span><span class="mi" id="MathJax-Span-1188" style="font-size: 70.7%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span></span><span class="mo" id="MathJax-Span-1189" style="font-family: MathJax_Main; padding-left: 0.283em;">=</span><span class="mi" id="MathJax-Span-1190" style="font-family: MathJax_Math-bold-italic; padding-left: 0.283em;">x</span></span></span><span style="display: inline-block; width: 0px; height: 3.985em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.969em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.28em; border-left: 0px solid; width: 0px; height: 5.166em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mtr><mtd></mtd><mtd><munder><mtext>argmax</mtext><mi mathvariant="bold-italic">x</mi></munder><mspace width="thinmathspace"></mspace><msub><mi>z</mi><mi>n</mi></msub></mtd></mtr><mtr><mtd></mtd><mtd><mtext>s.t.</mtext><mspace width="1em"></mspace><mi>g</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">z</mi><mo stretchy="false">)</mo><mo>=</mo><mn mathvariant="bold">0</mn></mtd></mtr><mtr><mtd></mtd><mtd><mtext>and</mtext><mspace width="1em"></mspace><msub><mi mathvariant="bold-italic">z</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>d</mi></mrow></msub><mo>=</mo><mi mathvariant="bold-italic">x</mi></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-71">
\begin{align*}
& \underset{\boldsymbol{x}}{\text{argmax}}\, z_n \\
& \text{s.t.}\quad g(\boldsymbol{z}) = \boldsymbol{0} \\
& \text{and}\quad \boldsymbol{z}_{1:d} = \boldsymbol{x}
\end{align*}
</script></div>
<p>where <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1191" style="width: 0.565em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.471em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.736em, 1000.47em, 2.626em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1192"><span class="mi" id="MathJax-Span-1193" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.269em; border-left: 0px solid; width: 0px; height: 0.872em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi></math></span></span><script type="math/tex" id="MathJax-Element-72">g</script></span> can be an any smooth multivariate function of the intermediate
variables! Of course, allowing cyclic constraints comes at the cost of a
more-difficult analogue of "the forward pass" to satisfy the <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1194" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.565em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.689em, 1000.57em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1195"><span class="mi" id="MathJax-Span-1196" style="font-family: MathJax_Math-bold-italic;">z</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.655em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">z</mi></math></span></span><script type="math/tex" id="MathJax-Element-73">\boldsymbol{z}</script></span>
equations (if we want to keep it a block-coordinate step). The
<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03BB;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1197" style="width: 0.799em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.455em, 1000.66em, 2.439em, -999.998em); top: -2.293em; left: 0em;"><span class="mrow" id="MathJax-Span-1198"><span class="mi" id="MathJax-Span-1199" style="font-family: MathJax_Math-bold-italic;">λ</span></span><span style="display: inline-block; width: 0px; height: 2.298em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.052em; border-left: 0px solid; width: 0px; height: 0.927em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">λ</mi></math></span></span><script type="math/tex" id="MathJax-Element-74">\boldsymbol{\lambda}</script></span> equations are now a linear system that requires a linear
solver (e.g., Gaussian elimination).</p>
<p>Example use cases:</p>
<ul>
<li>
<p>Bi-level optimization: Solving an optimization problem with another one inside
  it. For example,
  <a href="http://timvieira.github.io/blog/post/2016/03/05/gradient-based-hyperparameter-optimization-and-the-implicit-function-theorem/">gradient-based hyperparameter optimization</a>
  in machine learning. The implicit function theorem manages to get gradients of
  hyperparameters without needing to store any of intermediate states of the
  optimization algorithm used in the inner optimization! This is a <em>huge</em> memory
  saver since direct backprop on the inner gradient decent algorithm would
  require caching all intermediate states. Yikes!</p>
</li>
<li>
<p>Cyclic constraints are useful in many graph algorithms. For example, computing
  gradients of edge weights in a general finite-state machine or, similarly,
  computing the value function in a Markov decision process.</p>
</li>
</ul>
<h3>Other methods for optimization?</h3>
<p>The connection to Lagrangians brings tons of algorithms for constrained
optimization into the mix! We can imagine using more general algorithms for
optimizing our function and other ways of enforcing the constraints. We see
immediately that we could run optimization with adjoints set to values other
than those that backprop would set them to (i.e., we can optimize them like we'd
do in other algorithms for optimizing general Lagrangians).</p>
<h2>Summary</h2>
<p>Backprop is does not directly fall out of the the rules for differentiation
that you learned in calculus (e.g., the chain rule).</p>
<ul>
<li>This is because it operates on a more general family of functions: <em>programs</em>
  which have <em>intermediate variables</em>. Supporting intermediate variables is
  crucial for implementing both functions and their gradients efficiently.</li>
</ul>
<p>I described how we could use something we did learn from calculus 101, the
method of Lagrange multipliers, to support optimization with intermediate
variables.</p>
<ul>
<li>
<p>It turned out that backprop is a <em>particular instantiation</em> of the method of
  Lagrange multipliers, involving block-coordinate steps for solving for the
  intermediates and multipliers.</p>
</li>
<li>
<p>I also described a neat generalization to support <em>cyclic</em> programs and I
  hinted at ideas for doing optimization a little differently, deviating from
  the de facto block-coordinate strategy.</p>
</li>
</ul>
<p></p><center>
<img alt="Levels of enlightenment" src="backprop-brain-meme.png">
</center><p></p>
<h2>Further reading</h2>
<p>After working out the connection between backprop and the method of Lagrange
multipliers, I discovered following paper, which beat me to it. I don't think my
version is too redundant.</p>
<blockquote>
<p>Yann LeCun. (1988)
<a href="http://yann.lecun.com/exdb/publis/pdf/lecun-88.pdf">A Theoretical Framework from Back-Propagation</a>.</p>
</blockquote>
<p>Ben Recht has great blog post that uses the implicit function theorem to
<em>derive</em> the method of Lagrange multipliers. He also touches on the connection
to backpropagation.</p>
<blockquote>
<p>Ben Recht. (2016)
<a href="http://www.argmin.net/2016/05/31/mechanics-of-lagrangians/">Mechanics of Lagrangians</a>.</p>
</blockquote>
<p>Tom Goldstein's group took the Lagrangian view of backprop and used it to design
an ADMM approach for optimizing neural nets. The ADMM approach operates
massively parallel and leverages lots of highly optimized solvers for
subproblems. This work nicely demonstrates that understanding automatic
differentiation—in the broader sense that I described in this
post—facilitates the development of novel optimization algorithms. <!--
ADMM is based on a cool reformulation trick, which take a *big* circuit and
breaks it up into several *small* circuits (subproblems), which are *decoupled*
from the big problem because each subproblem gets to freely tune its own *local*
version of the variables. There is, of course, a global equality constraint on
the decoupled variables so that we get a correct solution. The global equality
constraints iteratively brings the subproblems into agreement.--></p>
<blockquote>
<p>Gavin Taylor, Ryan Burmeister, Zheng Xu, Bharat Singh, Ankit Patel, Tom Goldstein. (2018)
<a href="https://arxiv.org/abs/1605.02026">Training Neural Networks Without Gradients: A Scalable ADMM Approach</a>.</p>
</blockquote>
<p>The backpropagation algorithm can be cleanly generalized from values to
functionals!</p>
<blockquote>
<p>Alexander Grubb and J. Andrew Bagnell. (2010)
<a href="https://t.co/5OW5xBT4Y1">Boosted Backpropagation Learning for Training Deep Modular Networks</a>.</p>
</blockquote>
<h2>Code</h2>
<p>I have coded up and tested the Lagrangian perspective on automatic
differentiation that I presented in this article. The code is available in this
<a href="https://gist.github.com/timvieira/8addcb81dd622b0108e0e7e06af74185">gist</a>.</p>
<script src="8addcb81dd622b0108e0e7e06af74185.js"></script><link rel="stylesheet" href="gist-embed-a9a1cf2ca01efd362bfa52312712ae94.css"><div id="gist75842340" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-lagrangeprop-py" class="file">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-python ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-lagrangeprop-py-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-lagrangeprop-py-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span> -*- coding: utf-8 -*-</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-lagrangeprop-py-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-s"><span class="pl-pds">"""</span></span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-lagrangeprop-py-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-s">Backprop as the method of Lagrange multiplers (and even the implicit function</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-lagrangeprop-py-LC4" class="blob-code blob-code-inner js-file-line"><span class="pl-s">theorem).</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-lagrangeprop-py-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-s"><span class="pl-pds">"""</span></span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-lagrangeprop-py-LC6" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> <span class="pl-c1">__future__</span> <span class="pl-k">import</span> division</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-lagrangeprop-py-LC7" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> numpy <span class="pl-k">as</span> np</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-lagrangeprop-py-LC8" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> arsenal.alphabet <span class="pl-k">import</span> Alphabet</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-lagrangeprop-py-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> arsenal.math.checkgrad <span class="pl-k">import</span> finite_difference</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-lagrangeprop-py-LC10" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-lagrangeprop-py-LC11" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-lagrangeprop-py-LC12" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span> Implementation choice: I decided to separate the input-copy and intermediate</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-lagrangeprop-py-LC13" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span> constraints to avoid annoyances with having two namespaces (x and z). I</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-lagrangeprop-py-LC14" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span> suppose writing all constraints as functions of x and z seems more general,</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-lagrangeprop-py-LC15" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span> but with input-copy consraints we don't any expressivity we just have handle</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-lagrangeprop-py-LC16" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span> them with special cases (easy enough).</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-lagrangeprop-py-LC17" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-lagrangeprop-py-LC18" class="blob-code blob-code-inner js-file-line"><span class="pl-k">class</span> <span class="pl-en">Computation</span>:</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-lagrangeprop-py-LC19" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-lagrangeprop-py-LC20" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-c1">__init__</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">f</span>, <span class="pl-smi">inputs</span>, <span class="pl-smi">constraints</span>, <span class="pl-smi">df</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-lagrangeprop-py-LC21" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.d <span class="pl-k">=</span> <span class="pl-c1">len</span>(inputs)</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-lagrangeprop-py-LC22" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.n <span class="pl-k">=</span> <span class="pl-c1">self</span>.d <span class="pl-k">+</span> <span class="pl-c1">len</span>(constraints)</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-lagrangeprop-py-LC23" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.constraints <span class="pl-k">=</span> constraints</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-lagrangeprop-py-LC24" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.inputs <span class="pl-k">=</span> inputs</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-lagrangeprop-py-LC25" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.f <span class="pl-k">=</span> f</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-lagrangeprop-py-LC26" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.df <span class="pl-k">=</span> df</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-lagrangeprop-py-LC27" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-lagrangeprop-py-LC28" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">forward</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">x</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-lagrangeprop-py-LC29" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">"</span>Evaluate `f(x)`<span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-lagrangeprop-py-LC30" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> <span class="pl-c1">self</span>.f(<span class="pl-c1">self</span>.solve_constraints(x))</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-lagrangeprop-py-LC31" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-lagrangeprop-py-LC32" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">solve_constraints</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">x</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-lagrangeprop-py-LC33" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">"</span>Find a feasible solution to the constraints given `x`.<span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-lagrangeprop-py-LC34" class="blob-code blob-code-inner js-file-line">        z <span class="pl-k">=</span> np.zeros(<span class="pl-c1">self</span>.n)</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-lagrangeprop-py-LC35" class="blob-code blob-code-inner js-file-line">        z[<span class="pl-c1">self</span>.inputs] <span class="pl-k">=</span> x</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-lagrangeprop-py-LC36" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">for</span> c <span class="pl-k">in</span> <span class="pl-c1">self</span>.constraints:</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-lagrangeprop-py-LC37" class="blob-code blob-code-inner js-file-line">            c.solve(z)</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-lagrangeprop-py-LC38" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> z</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-lagrangeprop-py-LC39" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-lagrangeprop-py-LC40" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">lagrangian</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">x</span>, <span class="pl-smi">z</span>, <span class="pl-smi">l</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-lagrangeprop-py-LC41" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> (<span class="pl-c1">self</span>.f(z)</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-lagrangeprop-py-LC42" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">+</span> l[:<span class="pl-c1">self</span>.d].dot(x[:<span class="pl-c1">self</span>.d] <span class="pl-k">-</span> z[:<span class="pl-c1">self</span>.d])</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-lagrangeprop-py-LC43" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">+</span> l[<span class="pl-c1">self</span>.d:].dot(<span class="pl-c1">self</span>.constraints.penalties(z)))</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-lagrangeprop-py-LC44" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-lagrangeprop-py-LC45" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">dlagrangian</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">x</span>, <span class="pl-smi">z</span>, <span class="pl-smi">l</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-lagrangeprop-py-LC46" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">"</span>Compute gradients of the Lagrangian wrt each argument.<span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-lagrangeprop-py-LC47" class="blob-code blob-code-inner js-file-line">        dx <span class="pl-k">=</span> np.zeros_like(x)</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-lagrangeprop-py-LC48" class="blob-code blob-code-inner js-file-line">        dx <span class="pl-k">+=</span> l[:<span class="pl-c1">self</span>.d]</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-lagrangeprop-py-LC49" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-lagrangeprop-py-LC50" class="blob-code blob-code-inner js-file-line">        dz <span class="pl-k">=</span> <span class="pl-c1">self</span>.df(z) <span class="pl-k">+</span> <span class="pl-c1">self</span>.dconstraints(z).dot(l)</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-lagrangeprop-py-LC51" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-lagrangeprop-py-LC52" class="blob-code blob-code-inner js-file-line">        dl <span class="pl-k">=</span> np.zeros_like(l)</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-lagrangeprop-py-LC53" class="blob-code blob-code-inner js-file-line">        dl[:<span class="pl-c1">self</span>.d] <span class="pl-k">+=</span> x[<span class="pl-c1">self</span>.inputs] <span class="pl-k">-</span> z[<span class="pl-c1">self</span>.inputs]</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-lagrangeprop-py-LC54" class="blob-code blob-code-inner js-file-line">        dl[<span class="pl-c1">self</span>.d:] <span class="pl-k">+=</span> <span class="pl-c1">self</span>.constraints.penalties(z)</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-lagrangeprop-py-LC55" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-lagrangeprop-py-LC56" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> dx, dz, dl</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-lagrangeprop-py-LC57" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-lagrangeprop-py-LC58" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">dconstraints</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">z</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L59" class="blob-num js-line-number" data-line-number="59"></td>
        <td id="file-lagrangeprop-py-LC59" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">"</span>Evaluate constraint matrix for `z`.<span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L60" class="blob-num js-line-number" data-line-number="60"></td>
        <td id="file-lagrangeprop-py-LC60" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> Note: The linear system approach build a massive highly structure</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L61" class="blob-num js-line-number" data-line-number="61"></td>
        <td id="file-lagrangeprop-py-LC61" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> sparse matrix that represents the local gradients. This is really</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L62" class="blob-num js-line-number" data-line-number="62"></td>
        <td id="file-lagrangeprop-py-LC62" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> inefficient in most cases because we can aggregate gradients as we</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L63" class="blob-num js-line-number" data-line-number="63"></td>
        <td id="file-lagrangeprop-py-LC63" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> go. This avoids the need to materialize this monster matrix.</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L64" class="blob-num js-line-number" data-line-number="64"></td>
        <td id="file-lagrangeprop-py-LC64" class="blob-code blob-code-inner js-file-line">        D <span class="pl-k">=</span> np.zeros((<span class="pl-c1">self</span>.n, <span class="pl-c1">self</span>.n))</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L65" class="blob-num js-line-number" data-line-number="65"></td>
        <td id="file-lagrangeprop-py-LC65" class="blob-code blob-code-inner js-file-line">        D[<span class="pl-c1">self</span>.inputs, <span class="pl-c1">self</span>.inputs] <span class="pl-k">=</span> <span class="pl-k">-</span><span class="pl-c1">1</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L66" class="blob-num js-line-number" data-line-number="66"></td>
        <td id="file-lagrangeprop-py-LC66" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">for</span> c <span class="pl-k">in</span> <span class="pl-c1">self</span>.constraints:</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L67" class="blob-num js-line-number" data-line-number="67"></td>
        <td id="file-lagrangeprop-py-LC67" class="blob-code blob-code-inner js-file-line">            c.grad(z, D[:, c.i])</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L68" class="blob-num js-line-number" data-line-number="68"></td>
        <td id="file-lagrangeprop-py-LC68" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> D</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L69" class="blob-num js-line-number" data-line-number="69"></td>
        <td id="file-lagrangeprop-py-LC69" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L70" class="blob-num js-line-number" data-line-number="70"></td>
        <td id="file-lagrangeprop-py-LC70" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">reverse_mode</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">D</span>, <span class="pl-smi">v</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L71" class="blob-num js-line-number" data-line-number="71"></td>
        <td id="file-lagrangeprop-py-LC71" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">"</span>Solve upper triangular linear system, `D x = -v`.<span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L72" class="blob-num js-line-number" data-line-number="72"></td>
        <td id="file-lagrangeprop-py-LC72" class="blob-code blob-code-inner js-file-line">        l <span class="pl-k">=</span> v.copy()</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L73" class="blob-num js-line-number" data-line-number="73"></td>
        <td id="file-lagrangeprop-py-LC73" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">for</span> c <span class="pl-k">in</span> <span class="pl-c1">reversed</span>(<span class="pl-c1">self</span>.constraints):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L74" class="blob-num js-line-number" data-line-number="74"></td>
        <td id="file-lagrangeprop-py-LC74" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">for</span> a <span class="pl-k">in</span> c.args:</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L75" class="blob-num js-line-number" data-line-number="75"></td>
        <td id="file-lagrangeprop-py-LC75" class="blob-code blob-code-inner js-file-line">                l[a] <span class="pl-k">+=</span> l[c.i] <span class="pl-k">*</span> D[a, c.i]</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L76" class="blob-num js-line-number" data-line-number="76"></td>
        <td id="file-lagrangeprop-py-LC76" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> l</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L77" class="blob-num js-line-number" data-line-number="77"></td>
        <td id="file-lagrangeprop-py-LC77" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L78" class="blob-num js-line-number" data-line-number="78"></td>
        <td id="file-lagrangeprop-py-LC78" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">forward_mode</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">D</span>, <span class="pl-smi">v</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L79" class="blob-num js-line-number" data-line-number="79"></td>
        <td id="file-lagrangeprop-py-LC79" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">"</span>Solve upper triangular linear system, `Dᵀ = -v`.<span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L80" class="blob-num js-line-number" data-line-number="80"></td>
        <td id="file-lagrangeprop-py-LC80" class="blob-code blob-code-inner js-file-line">        l <span class="pl-k">=</span> v.copy()</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L81" class="blob-num js-line-number" data-line-number="81"></td>
        <td id="file-lagrangeprop-py-LC81" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">for</span> c <span class="pl-k">in</span> <span class="pl-c1">self</span>.constraints:</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L82" class="blob-num js-line-number" data-line-number="82"></td>
        <td id="file-lagrangeprop-py-LC82" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">for</span> a <span class="pl-k">in</span> c.args:</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L83" class="blob-num js-line-number" data-line-number="83"></td>
        <td id="file-lagrangeprop-py-LC83" class="blob-code blob-code-inner js-file-line">                l[c.i] <span class="pl-k">+=</span> l[a] <span class="pl-k">*</span> D[a, c.i]</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L84" class="blob-num js-line-number" data-line-number="84"></td>
        <td id="file-lagrangeprop-py-LC84" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> l</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L85" class="blob-num js-line-number" data-line-number="85"></td>
        <td id="file-lagrangeprop-py-LC85" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L86" class="blob-num js-line-number" data-line-number="86"></td>
        <td id="file-lagrangeprop-py-LC86" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L87" class="blob-num js-line-number" data-line-number="87"></td>
        <td id="file-lagrangeprop-py-LC87" class="blob-code blob-code-inner js-file-line"><span class="pl-k">class</span> <span class="pl-en">Constraint</span>:</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L88" class="blob-num js-line-number" data-line-number="88"></td>
        <td id="file-lagrangeprop-py-LC88" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-c1">__init__</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">i</span>, <span class="pl-smi">f</span>, <span class="pl-smi">args</span>, <span class="pl-smi">df</span><span class="pl-k">=</span><span class="pl-c1">None</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L89" class="blob-num js-line-number" data-line-number="89"></td>
        <td id="file-lagrangeprop-py-LC89" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.args <span class="pl-k">=</span> args</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L90" class="blob-num js-line-number" data-line-number="90"></td>
        <td id="file-lagrangeprop-py-LC90" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.i <span class="pl-k">=</span> i</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L91" class="blob-num js-line-number" data-line-number="91"></td>
        <td id="file-lagrangeprop-py-LC91" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.f <span class="pl-k">=</span> f</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L92" class="blob-num js-line-number" data-line-number="92"></td>
        <td id="file-lagrangeprop-py-LC92" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.df <span class="pl-k">=</span> df</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L93" class="blob-num js-line-number" data-line-number="93"></td>
        <td id="file-lagrangeprop-py-LC93" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> df <span class="pl-k">is</span> <span class="pl-c1">None</span>:</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L94" class="blob-num js-line-number" data-line-number="94"></td>
        <td id="file-lagrangeprop-py-LC94" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"><span class="pl-c">#</span> Use finite-difference approximation if user didn't pass in df.</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L95" class="blob-num js-line-number" data-line-number="95"></td>
        <td id="file-lagrangeprop-py-LC95" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">self</span>.df <span class="pl-k">=</span> <span class="pl-k">lambda</span> <span class="pl-smi">x</span>: finite_difference(f)(x).flatten()</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L96" class="blob-num js-line-number" data-line-number="96"></td>
        <td id="file-lagrangeprop-py-LC96" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L97" class="blob-num js-line-number" data-line-number="97"></td>
        <td id="file-lagrangeprop-py-LC97" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">solve</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">z</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L98" class="blob-num js-line-number" data-line-number="98"></td>
        <td id="file-lagrangeprop-py-LC98" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> Closed form solution to the constraint, could take a gradient step or</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L99" class="blob-num js-line-number" data-line-number="99"></td>
        <td id="file-lagrangeprop-py-LC99" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> solve a block-coordinate subproblem, more generally.</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L100" class="blob-num js-line-number" data-line-number="100"></td>
        <td id="file-lagrangeprop-py-LC100" class="blob-code blob-code-inner js-file-line">        z[<span class="pl-c1">self</span>.i] <span class="pl-k">=</span> <span class="pl-c1">self</span>.f(z[<span class="pl-c1">self</span>.args])</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L101" class="blob-num js-line-number" data-line-number="101"></td>
        <td id="file-lagrangeprop-py-LC101" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L102" class="blob-num js-line-number" data-line-number="102"></td>
        <td id="file-lagrangeprop-py-LC102" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">penalty</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">z</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L103" class="blob-num js-line-number" data-line-number="103"></td>
        <td id="file-lagrangeprop-py-LC103" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> <span class="pl-c1">float</span>(<span class="pl-c1">self</span>.f(z[<span class="pl-c1">self</span>.args]) <span class="pl-k">-</span> z[<span class="pl-c1">self</span>.i])</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L104" class="blob-num js-line-number" data-line-number="104"></td>
        <td id="file-lagrangeprop-py-LC104" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L105" class="blob-num js-line-number" data-line-number="105"></td>
        <td id="file-lagrangeprop-py-LC105" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">grad</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">z</span>, <span class="pl-smi">dz</span>, <span class="pl-smi">adj</span><span class="pl-k">=</span><span class="pl-c1">1</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L106" class="blob-num js-line-number" data-line-number="106"></td>
        <td id="file-lagrangeprop-py-LC106" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> Note: adjoint is scalar because constraint is scalar.</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L107" class="blob-num js-line-number" data-line-number="107"></td>
        <td id="file-lagrangeprop-py-LC107" class="blob-code blob-code-inner js-file-line">        dz[<span class="pl-c1">self</span>.args] <span class="pl-k">+=</span> adj <span class="pl-k">*</span> <span class="pl-c1">self</span>.df(z[<span class="pl-c1">self</span>.args])</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L108" class="blob-num js-line-number" data-line-number="108"></td>
        <td id="file-lagrangeprop-py-LC108" class="blob-code blob-code-inner js-file-line">        dz[<span class="pl-c1">self</span>.i] <span class="pl-k">+=</span> <span class="pl-k">-</span>adj</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L109" class="blob-num js-line-number" data-line-number="109"></td>
        <td id="file-lagrangeprop-py-LC109" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L110" class="blob-num js-line-number" data-line-number="110"></td>
        <td id="file-lagrangeprop-py-LC110" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L111" class="blob-num js-line-number" data-line-number="111"></td>
        <td id="file-lagrangeprop-py-LC111" class="blob-code blob-code-inner js-file-line"><span class="pl-k">class</span> <span class="pl-en">Constraints</span>(<span class="pl-c1">list</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L112" class="blob-num js-line-number" data-line-number="112"></td>
        <td id="file-lagrangeprop-py-LC112" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">"""</span>Handles string-valued names and certain conventions like inputs need to be</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L113" class="blob-num js-line-number" data-line-number="113"></td>
        <td id="file-lagrangeprop-py-LC113" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    the first vars.<span class="pl-pds">"""</span></span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L114" class="blob-num js-line-number" data-line-number="114"></td>
        <td id="file-lagrangeprop-py-LC114" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L115" class="blob-num js-line-number" data-line-number="115"></td>
        <td id="file-lagrangeprop-py-LC115" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-c1">__init__</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">inputs</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L116" class="blob-num js-line-number" data-line-number="116"></td>
        <td id="file-lagrangeprop-py-LC116" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.A <span class="pl-k">=</span> Alphabet()</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L117" class="blob-num js-line-number" data-line-number="117"></td>
        <td id="file-lagrangeprop-py-LC117" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.inputs <span class="pl-k">=</span> <span class="pl-c1">self</span>.A.map(inputs)  <span class="pl-c"><span class="pl-c">#</span> need inputs to be the first vars</span></td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L118" class="blob-num js-line-number" data-line-number="118"></td>
        <td id="file-lagrangeprop-py-LC118" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">super</span>(Constraints, <span class="pl-c1">self</span>).<span class="pl-c1">__init__</span>()</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L119" class="blob-num js-line-number" data-line-number="119"></td>
        <td id="file-lagrangeprop-py-LC119" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L120" class="blob-num js-line-number" data-line-number="120"></td>
        <td id="file-lagrangeprop-py-LC120" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">add_constraint</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">lhs</span>, <span class="pl-smi">f</span>, <span class="pl-smi">rhs</span>, <span class="pl-smi">df</span><span class="pl-k">=</span><span class="pl-c1">None</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L121" class="blob-num js-line-number" data-line-number="121"></td>
        <td id="file-lagrangeprop-py-LC121" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">self</span>.append(Constraint(<span class="pl-c1">self</span>.A[lhs], f, <span class="pl-c1">self</span>.A.map(rhs), df))</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L122" class="blob-num js-line-number" data-line-number="122"></td>
        <td id="file-lagrangeprop-py-LC122" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L123" class="blob-num js-line-number" data-line-number="123"></td>
        <td id="file-lagrangeprop-py-LC123" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">def</span> <span class="pl-en">penalties</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">z</span>):</td>
      </tr>
      <tr>
        <td id="file-lagrangeprop-py-L124" class="blob-num js-line-number" data-line-number="124"></td>
        <td id="file-lagrangeprop-py-LC124" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span> np.array([c.penalty(z) <span class="pl-k">for</span> c <span class="pl-k">in</span> <span class="pl-c1">self</span>])</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/timvieira/8addcb81dd622b0108e0e7e06af74185/raw/719622c71d2a7cd539fafd41f29de5ecb76d391e/lagrangeprop.py" style="float:right">view raw</a>
        <a href="https://gist.github.com/timvieira/8addcb81dd622b0108e0e7e06af74185#file-lagrangeprop-py">lagrangeprop.py</a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-tests-py" class="file">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-python ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-tests-py-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-tests-py-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span> -*- coding: utf-8 -*-</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-tests-py-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-s"><span class="pl-pds">"""</span></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-tests-py-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-s">Backprop as the method of Lagrange multiplers (and even the implicit function</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-tests-py-LC4" class="blob-code blob-code-inner js-file-line"><span class="pl-s">theorem).</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-tests-py-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-s"><span class="pl-pds">"""</span></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-tests-py-LC6" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> <span class="pl-c1">__future__</span> <span class="pl-k">import</span> division</td>
      </tr>
      <tr>
        <td id="file-tests-py-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-tests-py-LC7" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> numpy <span class="pl-k">as</span> np</td>
      </tr>
      <tr>
        <td id="file-tests-py-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-tests-py-LC8" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> scipy.linalg</td>
      </tr>
      <tr>
        <td id="file-tests-py-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-tests-py-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> lagrangeprop <span class="pl-k">import</span> Computation, Constraints</td>
      </tr>
      <tr>
        <td id="file-tests-py-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-tests-py-LC10" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> arsenal.math.checkgrad <span class="pl-k">import</span> finite_difference, fdcheck</td>
      </tr>
      <tr>
        <td id="file-tests-py-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-tests-py-LC11" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> arsenal.math <span class="pl-k">import</span> onehot, compare</td>
      </tr>
      <tr>
        <td id="file-tests-py-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-tests-py-LC12" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> arsenal <span class="pl-k">import</span> colors</td>
      </tr>
      <tr>
        <td id="file-tests-py-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-tests-py-LC13" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-tests-py-LC14" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-tests-py-LC15" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">test_implicit_diff_view</span>(<span class="pl-smi">L</span>):</td>
      </tr>
      <tr>
        <td id="file-tests-py-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-tests-py-LC16" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">"""</span></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-tests-py-LC17" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    Test connections between Lagrangian and implicit differentiation</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-tests-py-LC18" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-tests-py-LC19" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    If you have the Lagrangian view of backprop, then implicit functions should</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-tests-py-LC20" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    really pop out!</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-tests-py-LC21" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-tests-py-LC22" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    Think of forward propagation as a smooth blackbox function h that maps inputs</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-tests-py-LC23" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    (x) to intermediates (z).</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-tests-py-LC24" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-tests-py-LC25" class="blob-code blob-code-inner js-file-line"><span class="pl-s">      maximize f(z)</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-tests-py-LC26" class="blob-code blob-code-inner js-file-line"><span class="pl-s">      subjecto h(x) = z</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-tests-py-LC27" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-tests-py-LC28" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    Rewriting slightly, let g(x,z) = h(x) - z.</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-tests-py-LC29" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-tests-py-LC30" class="blob-code blob-code-inner js-file-line"><span class="pl-s">      maximize f(z)</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-tests-py-LC31" class="blob-code blob-code-inner js-file-line"><span class="pl-s">      subjecto g(x,z) = 0</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-tests-py-LC32" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-tests-py-LC33" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    With forward propagation we always satisfy the constraints, so g(x,z)=0. Thus,</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-tests-py-LC34" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    we also have "equilibrium" under little perturbations</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-tests-py-LC35" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-tests-py-LC36" class="blob-code blob-code-inner js-file-line"><span class="pl-s">      g(x+Δx, z+Δz) = g(x,z) + Δx ⋅ ∂g/∂x + Δz ⋅ ∂g/∂z = 0.</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-tests-py-LC37" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-tests-py-LC38" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    Since g(x,z) = 0,</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-tests-py-LC39" class="blob-code blob-code-inner js-file-line"><span class="pl-s">      Δx ⋅ ∂g/∂x + Δz ⋅ ∂g/∂z = 0</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-tests-py-LC40" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-tests-py-LC41" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    Solve for Δz/Δx,</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-tests-py-LC42" class="blob-code blob-code-inner js-file-line"><span class="pl-s">       Δz/Δx = - (∂g/∂z)^-1 ∂g/∂x  ← there's your linear system of equations!</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-tests-py-LC43" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-tests-py-LC44" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    Combine with the objective ∂f/∂z</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-tests-py-LC45" class="blob-code blob-code-inner js-file-line"><span class="pl-s">      ∂f/∂z Δz/Δx = ∂f/∂x</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-tests-py-LC46" class="blob-code blob-code-inner js-file-line"><span class="pl-s"></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-tests-py-LC47" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    <span class="pl-pds">"""</span></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-tests-py-LC48" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-tests-py-LC49" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.magenta <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>Implicit differentiation:<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="file-tests-py-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-tests-py-LC50" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-tests-py-LC51" class="blob-code blob-code-inner js-file-line">    x <span class="pl-k">=</span> np.random.randn(L.d)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-tests-py-LC52" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-tests-py-LC53" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> Important! connection only holds when constraints are satisfied!</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-tests-py-LC54" class="blob-code blob-code-inner js-file-line">    z <span class="pl-k">=</span> L.solve_constraints(x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-tests-py-LC55" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-tests-py-LC56" class="blob-code blob-code-inner js-file-line">    f_dz_dx <span class="pl-k">=</span> finite_difference(L.solve_constraints)(x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-tests-py-LC57" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-tests-py-LC58" class="blob-code blob-code-inner js-file-line">    dC_dx <span class="pl-k">=</span> np.zeros((L.n, L.d))</td>
      </tr>
      <tr>
        <td id="file-tests-py-L59" class="blob-num js-line-number" data-line-number="59"></td>
        <td id="file-tests-py-LC59" class="blob-code blob-code-inner js-file-line">    dC_dx[L.inputs,L.inputs] <span class="pl-k">=</span> <span class="pl-c1">1</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L60" class="blob-num js-line-number" data-line-number="60"></td>
        <td id="file-tests-py-LC60" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L61" class="blob-num js-line-number" data-line-number="61"></td>
        <td id="file-tests-py-LC61" class="blob-code blob-code-inner js-file-line">    dC_dz <span class="pl-k">=</span> L.dconstraints(z)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L62" class="blob-num js-line-number" data-line-number="62"></td>
        <td id="file-tests-py-LC62" class="blob-code blob-code-inner js-file-line">    dz_dx <span class="pl-k">=</span> <span class="pl-k">-</span>scipy.linalg.solve(dC_dz.T, dC_dx).T</td>
      </tr>
      <tr>
        <td id="file-tests-py-L63" class="blob-num js-line-number" data-line-number="63"></td>
        <td id="file-tests-py-LC63" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L64" class="blob-num js-line-number" data-line-number="64"></td>
        <td id="file-tests-py-LC64" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> np.allclose(f_dz_dx, dz_dx)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L65" class="blob-num js-line-number" data-line-number="65"></td>
        <td id="file-tests-py-LC65" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L66" class="blob-num js-line-number" data-line-number="66"></td>
        <td id="file-tests-py-LC66" class="blob-code blob-code-inner js-file-line">    df_dz <span class="pl-k">=</span> L.df(z)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L67" class="blob-num js-line-number" data-line-number="67"></td>
        <td id="file-tests-py-LC67" class="blob-code blob-code-inner js-file-line">    f_df_dx <span class="pl-k">=</span> finite_difference(L.forward)(x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L68" class="blob-num js-line-number" data-line-number="68"></td>
        <td id="file-tests-py-LC68" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L69" class="blob-num js-line-number" data-line-number="69"></td>
        <td id="file-tests-py-LC69" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> np.allclose(f_df_dx, dz_dx.dot(df_dz))</td>
      </tr>
      <tr>
        <td id="file-tests-py-L70" class="blob-num js-line-number" data-line-number="70"></td>
        <td id="file-tests-py-LC70" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L71" class="blob-num js-line-number" data-line-number="71"></td>
        <td id="file-tests-py-LC71" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.green <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>ok<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L72" class="blob-num js-line-number" data-line-number="72"></td>
        <td id="file-tests-py-LC72" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L73" class="blob-num js-line-number" data-line-number="73"></td>
        <td id="file-tests-py-LC73" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L74" class="blob-num js-line-number" data-line-number="74"></td>
        <td id="file-tests-py-LC74" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">test_forward_mode</span>(<span class="pl-smi">L</span>):</td>
      </tr>
      <tr>
        <td id="file-tests-py-L75" class="blob-num js-line-number" data-line-number="75"></td>
        <td id="file-tests-py-LC75" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.magenta <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>Forward-mode:<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="file-tests-py-L76" class="blob-num js-line-number" data-line-number="76"></td>
        <td id="file-tests-py-LC76" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L77" class="blob-num js-line-number" data-line-number="77"></td>
        <td id="file-tests-py-LC77" class="blob-code blob-code-inner js-file-line">    x <span class="pl-k">=</span> np.random.randn(L.d)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L78" class="blob-num js-line-number" data-line-number="78"></td>
        <td id="file-tests-py-LC78" class="blob-code blob-code-inner js-file-line">    z <span class="pl-k">=</span> L.solve_constraints(x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L79" class="blob-num js-line-number" data-line-number="79"></td>
        <td id="file-tests-py-LC79" class="blob-code blob-code-inner js-file-line">    D <span class="pl-k">=</span> L.dconstraints(z)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L80" class="blob-num js-line-number" data-line-number="80"></td>
        <td id="file-tests-py-LC80" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L81" class="blob-num js-line-number" data-line-number="81"></td>
        <td id="file-tests-py-LC81" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> Compare methods to finite-difference approximation to ∇f(x)</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L82" class="blob-num js-line-number" data-line-number="82"></td>
        <td id="file-tests-py-LC82" class="blob-code blob-code-inner js-file-line">    f_df_dx <span class="pl-k">=</span> finite_difference(L.forward)(x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L83" class="blob-num js-line-number" data-line-number="83"></td>
        <td id="file-tests-py-LC83" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L84" class="blob-num js-line-number" data-line-number="84"></td>
        <td id="file-tests-py-LC84" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> In forward mode, λ is interpreted as a vector of "tangents" pertaining to</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L85" class="blob-num js-line-number" data-line-number="85"></td>
        <td id="file-tests-py-LC85" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> a single input, instead of "adjoints" of the single output. Tangents are</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L86" class="blob-num js-line-number" data-line-number="86"></td>
        <td id="file-tests-py-LC86" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> equal to rows(cols?) of the Jacobian of the constraints.</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L87" class="blob-num js-line-number" data-line-number="87"></td>
        <td id="file-tests-py-LC87" class="blob-code blob-code-inner js-file-line">    f_dz_dx <span class="pl-k">=</span> finite_difference(L.solve_constraints)(x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L88" class="blob-num js-line-number" data-line-number="88"></td>
        <td id="file-tests-py-LC88" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L89" class="blob-num js-line-number" data-line-number="89"></td>
        <td id="file-tests-py-LC89" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">for</span> i <span class="pl-k">in</span> <span class="pl-c1">range</span>(L.d):   <span class="pl-c"><span class="pl-c">#</span> loop over each input</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L90" class="blob-num js-line-number" data-line-number="90"></td>
        <td id="file-tests-py-LC90" class="blob-code blob-code-inner js-file-line">        l <span class="pl-k">=</span> L.forward_mode(D, onehot(i, L.n))</td>
      </tr>
      <tr>
        <td id="file-tests-py-L91" class="blob-num js-line-number" data-line-number="91"></td>
        <td id="file-tests-py-LC91" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">assert</span> np.allclose(f_dz_dx[i], l)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L92" class="blob-num js-line-number" data-line-number="92"></td>
        <td id="file-tests-py-LC92" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L93" class="blob-num js-line-number" data-line-number="93"></td>
        <td id="file-tests-py-LC93" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">#</span> df/dz * dz/dx[i] =&gt; df/dx[i]</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L94" class="blob-num js-line-number" data-line-number="94"></td>
        <td id="file-tests-py-LC94" class="blob-code blob-code-inner js-file-line">        gi <span class="pl-k">=</span> L.df(z).dot(l)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L95" class="blob-num js-line-number" data-line-number="95"></td>
        <td id="file-tests-py-LC95" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">assert</span> np.allclose(f_df_dx[i], gi)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L96" class="blob-num js-line-number" data-line-number="96"></td>
        <td id="file-tests-py-LC96" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L97" class="blob-num js-line-number" data-line-number="97"></td>
        <td id="file-tests-py-LC97" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.green <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>ok<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L98" class="blob-num js-line-number" data-line-number="98"></td>
        <td id="file-tests-py-LC98" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L99" class="blob-num js-line-number" data-line-number="99"></td>
        <td id="file-tests-py-LC99" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L100" class="blob-num js-line-number" data-line-number="100"></td>
        <td id="file-tests-py-LC100" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">test_dlagrangian</span>(<span class="pl-smi">L</span>):</td>
      </tr>
      <tr>
        <td id="file-tests-py-L101" class="blob-num js-line-number" data-line-number="101"></td>
        <td id="file-tests-py-LC101" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.magenta <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>Finite-difference Lagrangian:<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="file-tests-py-L102" class="blob-num js-line-number" data-line-number="102"></td>
        <td id="file-tests-py-LC102" class="blob-code blob-code-inner js-file-line">    x <span class="pl-k">=</span> np.random.randn(L.d)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L103" class="blob-num js-line-number" data-line-number="103"></td>
        <td id="file-tests-py-LC103" class="blob-code blob-code-inner js-file-line">    z <span class="pl-k">=</span> np.random.uniform(<span class="pl-k">-</span><span class="pl-c1">1</span>,<span class="pl-c1">1</span>,<span class="pl-v">size</span><span class="pl-k">=</span>L.n)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L104" class="blob-num js-line-number" data-line-number="104"></td>
        <td id="file-tests-py-LC104" class="blob-code blob-code-inner js-file-line">    l <span class="pl-k">=</span> np.random.uniform(<span class="pl-k">-</span><span class="pl-c1">1</span>,<span class="pl-c1">1</span>,<span class="pl-v">size</span><span class="pl-k">=</span>L.n)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L105" class="blob-num js-line-number" data-line-number="105"></td>
        <td id="file-tests-py-LC105" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L106" class="blob-num js-line-number" data-line-number="106"></td>
        <td id="file-tests-py-LC106" class="blob-code blob-code-inner js-file-line">    dx, dz, dl <span class="pl-k">=</span> L.dlagrangian(x, z, l)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L107" class="blob-num js-line-number" data-line-number="107"></td>
        <td id="file-tests-py-LC107" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> fdcheck(<span class="pl-k">lambda</span>: L.lagrangian(x, z, l), z, dz, <span class="pl-v">quiet</span><span class="pl-k">=</span><span class="pl-c1">1</span>).mean_relative_error <span class="pl-k">&lt;</span> <span class="pl-c1">0.01</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L108" class="blob-num js-line-number" data-line-number="108"></td>
        <td id="file-tests-py-LC108" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> fdcheck(<span class="pl-k">lambda</span>: L.lagrangian(x, z, l), x, dx, <span class="pl-v">quiet</span><span class="pl-k">=</span><span class="pl-c1">1</span>).mean_relative_error <span class="pl-k">&lt;</span> <span class="pl-c1">0.01</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L109" class="blob-num js-line-number" data-line-number="109"></td>
        <td id="file-tests-py-LC109" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> fdcheck(<span class="pl-k">lambda</span>: L.lagrangian(x, z, l), l, dl, <span class="pl-v">quiet</span><span class="pl-k">=</span><span class="pl-c1">1</span>).mean_relative_error <span class="pl-k">&lt;</span> <span class="pl-c1">0.01</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L110" class="blob-num js-line-number" data-line-number="110"></td>
        <td id="file-tests-py-LC110" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.green <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>ok<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L111" class="blob-num js-line-number" data-line-number="111"></td>
        <td id="file-tests-py-LC111" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L112" class="blob-num js-line-number" data-line-number="112"></td>
        <td id="file-tests-py-LC112" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L113" class="blob-num js-line-number" data-line-number="113"></td>
        <td id="file-tests-py-LC113" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">test_reverse_mode</span>(<span class="pl-smi">L</span>):</td>
      </tr>
      <tr>
        <td id="file-tests-py-L114" class="blob-num js-line-number" data-line-number="114"></td>
        <td id="file-tests-py-LC114" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.magenta <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>Reverse-mode:<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="file-tests-py-L115" class="blob-num js-line-number" data-line-number="115"></td>
        <td id="file-tests-py-LC115" class="blob-code blob-code-inner js-file-line">    x <span class="pl-k">=</span> np.random.randn(L.d)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L116" class="blob-num js-line-number" data-line-number="116"></td>
        <td id="file-tests-py-LC116" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L117" class="blob-num js-line-number" data-line-number="117"></td>
        <td id="file-tests-py-LC117" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> Compare methods to finite-difference approximation to ∇f(x)</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L118" class="blob-num js-line-number" data-line-number="118"></td>
        <td id="file-tests-py-LC118" class="blob-code blob-code-inner js-file-line">    f_df_dx <span class="pl-k">=</span> finite_difference(L.forward)(x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L119" class="blob-num js-line-number" data-line-number="119"></td>
        <td id="file-tests-py-LC119" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L120" class="blob-num js-line-number" data-line-number="120"></td>
        <td id="file-tests-py-LC120" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> run forward to cache all the relavant stuff.</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L121" class="blob-num js-line-number" data-line-number="121"></td>
        <td id="file-tests-py-LC121" class="blob-code blob-code-inner js-file-line">    z <span class="pl-k">=</span> L.solve_constraints(x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L122" class="blob-num js-line-number" data-line-number="122"></td>
        <td id="file-tests-py-LC122" class="blob-code blob-code-inner js-file-line">    l <span class="pl-k">=</span> L.reverse_mode(L.dconstraints(z), L.df(z))</td>
      </tr>
      <tr>
        <td id="file-tests-py-L123" class="blob-num js-line-number" data-line-number="123"></td>
        <td id="file-tests-py-LC123" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L124" class="blob-num js-line-number" data-line-number="124"></td>
        <td id="file-tests-py-LC124" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> np.allclose(f_df_dx, l[:L.d])</td>
      </tr>
      <tr>
        <td id="file-tests-py-L125" class="blob-num js-line-number" data-line-number="125"></td>
        <td id="file-tests-py-LC125" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.green <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>ok<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L126" class="blob-num js-line-number" data-line-number="126"></td>
        <td id="file-tests-py-LC126" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L127" class="blob-num js-line-number" data-line-number="127"></td>
        <td id="file-tests-py-LC127" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L128" class="blob-num js-line-number" data-line-number="128"></td>
        <td id="file-tests-py-LC128" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">test_linear_system</span>(<span class="pl-smi">L</span>):</td>
      </tr>
      <tr>
        <td id="file-tests-py-L129" class="blob-num js-line-number" data-line-number="129"></td>
        <td id="file-tests-py-LC129" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.magenta <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>Linear solve:<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="file-tests-py-L130" class="blob-num js-line-number" data-line-number="130"></td>
        <td id="file-tests-py-LC130" class="blob-code blob-code-inner js-file-line">    x <span class="pl-k">=</span> np.random.randn(L.d)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L131" class="blob-num js-line-number" data-line-number="131"></td>
        <td id="file-tests-py-LC131" class="blob-code blob-code-inner js-file-line">    f_df_dx <span class="pl-k">=</span> finite_difference(L.forward)(x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L132" class="blob-num js-line-number" data-line-number="132"></td>
        <td id="file-tests-py-LC132" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L133" class="blob-num js-line-number" data-line-number="133"></td>
        <td id="file-tests-py-LC133" class="blob-code blob-code-inner js-file-line">    z <span class="pl-k">=</span> L.solve_constraints(x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L134" class="blob-num js-line-number" data-line-number="134"></td>
        <td id="file-tests-py-LC134" class="blob-code blob-code-inner js-file-line">    D <span class="pl-k">=</span> L.dconstraints(z)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L135" class="blob-num js-line-number" data-line-number="135"></td>
        <td id="file-tests-py-LC135" class="blob-code blob-code-inner js-file-line">    l <span class="pl-k">=</span> L.reverse_mode(D, L.df(z))</td>
      </tr>
      <tr>
        <td id="file-tests-py-L136" class="blob-num js-line-number" data-line-number="136"></td>
        <td id="file-tests-py-LC136" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L137" class="blob-num js-line-number" data-line-number="137"></td>
        <td id="file-tests-py-LC137" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> Run linear system solver -- Note that `linalg.solve` is generally worse at</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L138" class="blob-num js-line-number" data-line-number="138"></td>
        <td id="file-tests-py-LC138" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> solving the equations than `linalg.solve_triangular` (or equivalently</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L139" class="blob-num js-line-number" data-line-number="139"></td>
        <td id="file-tests-py-LC139" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> reverse mode). This is because the solver doesn't realize that the system</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L140" class="blob-num js-line-number" data-line-number="140"></td>
        <td id="file-tests-py-LC140" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> is upper triangular so it uses unstable operations like division and</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L141" class="blob-num js-line-number" data-line-number="141"></td>
        <td id="file-tests-py-LC141" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> subtraction.</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L142" class="blob-num js-line-number" data-line-number="142"></td>
        <td id="file-tests-py-LC142" class="blob-code blob-code-inner js-file-line">    sol <span class="pl-k">=</span> scipy.linalg.solve(D, <span class="pl-k">-</span>L.df(z))</td>
      </tr>
      <tr>
        <td id="file-tests-py-L143" class="blob-num js-line-number" data-line-number="143"></td>
        <td id="file-tests-py-LC143" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> np.allclose(l, sol)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L144" class="blob-num js-line-number" data-line-number="144"></td>
        <td id="file-tests-py-LC144" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> np.allclose(f_df_dx, sol[:L.d])</td>
      </tr>
      <tr>
        <td id="file-tests-py-L145" class="blob-num js-line-number" data-line-number="145"></td>
        <td id="file-tests-py-LC145" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L146" class="blob-num js-line-number" data-line-number="146"></td>
        <td id="file-tests-py-LC146" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">#</span> test aupper triangular solver</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L147" class="blob-num js-line-number" data-line-number="147"></td>
        <td id="file-tests-py-LC147" class="blob-code blob-code-inner js-file-line">    sol <span class="pl-k">=</span> scipy.linalg.solve_triangular(D, <span class="pl-k">-</span>L.df(z))</td>
      </tr>
      <tr>
        <td id="file-tests-py-L148" class="blob-num js-line-number" data-line-number="148"></td>
        <td id="file-tests-py-LC148" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> np.allclose(f_df_dx, sol[:L.d])</td>
      </tr>
      <tr>
        <td id="file-tests-py-L149" class="blob-num js-line-number" data-line-number="149"></td>
        <td id="file-tests-py-LC149" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> np.allclose(l, sol)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L150" class="blob-num js-line-number" data-line-number="150"></td>
        <td id="file-tests-py-LC150" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L151" class="blob-num js-line-number" data-line-number="151"></td>
        <td id="file-tests-py-LC151" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.green <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>ok<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L152" class="blob-num js-line-number" data-line-number="152"></td>
        <td id="file-tests-py-LC152" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L153" class="blob-num js-line-number" data-line-number="153"></td>
        <td id="file-tests-py-LC153" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L154" class="blob-num js-line-number" data-line-number="154"></td>
        <td id="file-tests-py-LC154" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">test_blockcoordinate</span>(<span class="pl-smi">L</span>):</td>
      </tr>
      <tr>
        <td id="file-tests-py-L155" class="blob-num js-line-number" data-line-number="155"></td>
        <td id="file-tests-py-LC155" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.magenta <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>Block-coordinate updates for z and λ:<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="file-tests-py-L156" class="blob-num js-line-number" data-line-number="156"></td>
        <td id="file-tests-py-LC156" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L157" class="blob-num js-line-number" data-line-number="157"></td>
        <td id="file-tests-py-LC157" class="blob-code blob-code-inner js-file-line">    x <span class="pl-k">=</span> np.random.randn(L.d)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L158" class="blob-num js-line-number" data-line-number="158"></td>
        <td id="file-tests-py-LC158" class="blob-code blob-code-inner js-file-line">    z <span class="pl-k">=</span> L.solve_constraints(x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L159" class="blob-num js-line-number" data-line-number="159"></td>
        <td id="file-tests-py-LC159" class="blob-code blob-code-inner js-file-line">    l <span class="pl-k">=</span> L.reverse_mode(L.dconstraints(z), L.df(z))</td>
      </tr>
      <tr>
        <td id="file-tests-py-L160" class="blob-num js-line-number" data-line-number="160"></td>
        <td id="file-tests-py-LC160" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L161" class="blob-num js-line-number" data-line-number="161"></td>
        <td id="file-tests-py-LC161" class="blob-code blob-code-inner js-file-line">    dx, dz, dl <span class="pl-k">=</span> L.dlagrangian(x, z, l)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L162" class="blob-num js-line-number" data-line-number="162"></td>
        <td id="file-tests-py-LC162" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> np.allclose(dx, l[:L.d])</td>
      </tr>
      <tr>
        <td id="file-tests-py-L163" class="blob-num js-line-number" data-line-number="163"></td>
        <td id="file-tests-py-LC163" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> np.abs(dz).max() <span class="pl-k">&lt;=</span> <span class="pl-c1">1e-5</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L164" class="blob-num js-line-number" data-line-number="164"></td>
        <td id="file-tests-py-LC164" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">assert</span> np.allclose(dl, <span class="pl-c1">0</span>)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L165" class="blob-num js-line-number" data-line-number="165"></td>
        <td id="file-tests-py-LC165" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L166" class="blob-num js-line-number" data-line-number="166"></td>
        <td id="file-tests-py-LC166" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> colors.green <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span>ok<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L167" class="blob-num js-line-number" data-line-number="167"></td>
        <td id="file-tests-py-LC167" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L168" class="blob-num js-line-number" data-line-number="168"></td>
        <td id="file-tests-py-LC168" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L169" class="blob-num js-line-number" data-line-number="169"></td>
        <td id="file-tests-py-LC169" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">main</span>():</td>
      </tr>
      <tr>
        <td id="file-tests-py-L170" class="blob-num js-line-number" data-line-number="170"></td>
        <td id="file-tests-py-LC170" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L171" class="blob-num js-line-number" data-line-number="171"></td>
        <td id="file-tests-py-LC171" class="blob-code blob-code-inner js-file-line">    C <span class="pl-k">=</span> Constraints([<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-tests-py-L172" class="blob-num js-line-number" data-line-number="172"></td>
        <td id="file-tests-py-LC172" class="blob-code blob-code-inner js-file-line">    C.add_constraint(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, np.exp,         [<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>],         <span class="pl-v">df</span><span class="pl-k">=</span>np.exp)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L173" class="blob-num js-line-number" data-line-number="173"></td>
        <td id="file-tests-py-LC173" class="blob-code blob-code-inner js-file-line">    C.add_constraint(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">x</span>: x<span class="pl-k">**</span><span class="pl-c1">2</span>, [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>],         <span class="pl-v">df</span><span class="pl-k">=</span><span class="pl-k">lambda</span> <span class="pl-smi">x</span>: <span class="pl-c1">2</span><span class="pl-k">*</span>x)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L174" class="blob-num js-line-number" data-line-number="174"></td>
        <td id="file-tests-py-LC174" class="blob-code blob-code-inner js-file-line">    C.add_constraint(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, np.sum,         [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>], <span class="pl-v">df</span><span class="pl-k">=</span>np.ones_like)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L175" class="blob-num js-line-number" data-line-number="175"></td>
        <td id="file-tests-py-LC175" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span>    C.add_constraint('c', np.product,     ['a','b','y'])</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L176" class="blob-num js-line-number" data-line-number="176"></td>
        <td id="file-tests-py-LC176" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span>    C.add_constraint('d', np.exp,         ['c'],         df=np.exp)</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L177" class="blob-num js-line-number" data-line-number="177"></td>
        <td id="file-tests-py-LC177" class="blob-code blob-code-inner js-file-line">    C.add_constraint(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>, np.tanh,        [<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="file-tests-py-L178" class="blob-num js-line-number" data-line-number="178"></td>
        <td id="file-tests-py-LC178" class="blob-code blob-code-inner js-file-line">    C.add_constraint(<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span>, np.sin,         [<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>],         <span class="pl-v">df</span><span class="pl-k">=</span>np.cos)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L179" class="blob-num js-line-number" data-line-number="179"></td>
        <td id="file-tests-py-LC179" class="blob-code blob-code-inner js-file-line">    C.add_constraint(<span class="pl-s"><span class="pl-pds">'</span>f<span class="pl-pds">'</span></span>, np.sum,         [<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span>],     <span class="pl-v">df</span><span class="pl-k">=</span>np.ones_like)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L180" class="blob-num js-line-number" data-line-number="180"></td>
        <td id="file-tests-py-LC180" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L181" class="blob-num js-line-number" data-line-number="181"></td>
        <td id="file-tests-py-LC181" class="blob-code blob-code-inner js-file-line">    n <span class="pl-k">=</span> <span class="pl-c1">len</span>(C.inputs) <span class="pl-k">+</span> <span class="pl-c1">len</span>(C)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L182" class="blob-num js-line-number" data-line-number="182"></td>
        <td id="file-tests-py-LC182" class="blob-code blob-code-inner js-file-line">    _r <span class="pl-k">=</span> np.random.randn(n)    <span class="pl-c"><span class="pl-c">#</span> random linear function of intermediate nodes</span></td>
      </tr>
      <tr>
        <td id="file-tests-py-L183" class="blob-num js-line-number" data-line-number="183"></td>
        <td id="file-tests-py-LC183" class="blob-code blob-code-inner js-file-line">    f <span class="pl-k">=</span> _r.dot</td>
      </tr>
      <tr>
        <td id="file-tests-py-L184" class="blob-num js-line-number" data-line-number="184"></td>
        <td id="file-tests-py-LC184" class="blob-code blob-code-inner js-file-line">    df <span class="pl-k">=</span> <span class="pl-k">lambda</span> <span class="pl-smi">z</span>: _r.copy()</td>
      </tr>
      <tr>
        <td id="file-tests-py-L185" class="blob-num js-line-number" data-line-number="185"></td>
        <td id="file-tests-py-LC185" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L186" class="blob-num js-line-number" data-line-number="186"></td>
        <td id="file-tests-py-LC186" class="blob-code blob-code-inner js-file-line">    L <span class="pl-k">=</span> Computation(f, C.inputs, C, <span class="pl-v">df</span> <span class="pl-k">=</span> df)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L187" class="blob-num js-line-number" data-line-number="187"></td>
        <td id="file-tests-py-LC187" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L188" class="blob-num js-line-number" data-line-number="188"></td>
        <td id="file-tests-py-LC188" class="blob-code blob-code-inner js-file-line">    test_dlagrangian(L)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L189" class="blob-num js-line-number" data-line-number="189"></td>
        <td id="file-tests-py-LC189" class="blob-code blob-code-inner js-file-line">    test_reverse_mode(L)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L190" class="blob-num js-line-number" data-line-number="190"></td>
        <td id="file-tests-py-LC190" class="blob-code blob-code-inner js-file-line">    test_forward_mode(L)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L191" class="blob-num js-line-number" data-line-number="191"></td>
        <td id="file-tests-py-LC191" class="blob-code blob-code-inner js-file-line">    test_linear_system(L)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L192" class="blob-num js-line-number" data-line-number="192"></td>
        <td id="file-tests-py-LC192" class="blob-code blob-code-inner js-file-line">    test_blockcoordinate(L)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L193" class="blob-num js-line-number" data-line-number="193"></td>
        <td id="file-tests-py-LC193" class="blob-code blob-code-inner js-file-line">    test_implicit_diff_view(L)</td>
      </tr>
      <tr>
        <td id="file-tests-py-L194" class="blob-num js-line-number" data-line-number="194"></td>
        <td id="file-tests-py-LC194" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L195" class="blob-num js-line-number" data-line-number="195"></td>
        <td id="file-tests-py-LC195" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-tests-py-L196" class="blob-num js-line-number" data-line-number="196"></td>
        <td id="file-tests-py-LC196" class="blob-code blob-code-inner js-file-line"><span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>__main__<span class="pl-pds">'</span></span>:</td>
      </tr>
      <tr>
        <td id="file-tests-py-L197" class="blob-num js-line-number" data-line-number="197"></td>
        <td id="file-tests-py-LC197" class="blob-code blob-code-inner js-file-line">    main()</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/timvieira/8addcb81dd622b0108e0e7e06af74185/raw/719622c71d2a7cd539fafd41f29de5ecb76d391e/tests.py" style="float:right">view raw</a>
        <a href="https://gist.github.com/timvieira/8addcb81dd622b0108e0e7e06af74185#file-tests-py">tests.py</a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>


<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Tim Vieira
    </span>
  </span>
<time datetime="2017-08-18T00:00:00-04:00" pubdate="">Aug 18, 2017</time>  <span class="categories">
    <a class="category" href="https://timvieira.github.io/blog/category/misc.html">misc</a>
  </span>
  <span class="categories">
    <a class="category" href="https://timvieira.github.io/blog/tag/calculus.html">calculus</a>,    <a class="category" href="https://timvieira.github.io/blog/tag/automatic-differentiation.html">automatic-differentiation</a>  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><iframe id="dsq-app7451" name="dsq-app7451" allowtransparency="true" scrolling="no" tabindex="0" title="Disqus" src="https://disqus.com/embed/comments/?base=default&amp;f=graduatedescent&amp;t_i=%2Fpost%2F2017%2F08%2F18%2Fbackprop-is-not-just-the-chain-rule%2F&amp;t_u=..%2F..%2F..%2F..%2F..%2Fpost%2F2017%2F08%2F18%2Fbackprop-is-not-just-the-chain-rule%2F&amp;t_e=Backprop%20is%20not%20just%20the%20chain%20rule&amp;t_d=Backprop%20is%20not%20just%20the%20chain%20rule&amp;t_t=Backprop%20is%20not%20just%20the%20chain%20rule&amp;s_o=default&amp;d_m=2#version=3cd87e0f949a3290918feaf8a303966c" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 695px !important;" horizontalscrolling="no" verticalscrolling="no" width="100%" frameborder="0"></iframe></div>
  </section>
</div>
<aside class="sidebar">
  <section class="odd">
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="https://timvieira.github.io/blog/post/2018/03/16/black-box-optimization/">Black-box optimization</a>
      </li>
      <li class="post">
          <a href="https://timvieira.github.io/blog/post/2017/08/18/backprop-is-not-just-the-chain-rule/">Backprop is not just the chain rule</a>
      </li>
      <li class="post">
          <a href="https://timvieira.github.io/blog/post/2017/07/03/estimating-means-in-a-finite-universe/">Estimating means in a finite universe</a>
      </li>
      <li class="post">
          <a href="https://timvieira.github.io/blog/post/2017/04/21/how-to-test-gradient-implementations/">How to test gradient implementations</a>
      </li>
      <li class="post">
          <a href="https://timvieira.github.io/blog/post/2016/12/19/counterfactual-reasoning-and-learning-from-logged-data/">Counterfactual reasoning and learning from logged data</a>
      </li>
    </ul>
  </section>

  <section class="even">
  <h1>Tags</h1>
    <a href="https://timvieira.github.io/blog/tag/optimization.html">optimization</a>,    <a href="https://timvieira.github.io/blog/tag/calculus.html">calculus</a>,    <a href="https://timvieira.github.io/blog/tag/automatic-differentiation.html">automatic-differentiation</a>,    <a href="https://timvieira.github.io/blog/tag/sampling.html">sampling</a>,    <a href="https://timvieira.github.io/blog/tag/statistics.html">statistics</a>,    <a href="https://timvieira.github.io/blog/tag/reservoir-sampling.html">reservoir-sampling</a>,    <a href="https://timvieira.github.io/blog/tag/testing.html">testing</a>,    <a href="https://timvieira.github.io/blog/tag/counterfactual-reasoning.html">counterfactual-reasoning</a>,    <a href="https://timvieira.github.io/blog/tag/importance-sampling.html">importance-sampling</a>,    <a href="https://timvieira.github.io/blog/tag/machine-learning.html">machine-learning</a>,    <a href="https://timvieira.github.io/blog/tag/datastructures.html">datastructures</a>,    <a href="https://timvieira.github.io/blog/tag/algorithms.html">algorithms</a>,    <a href="https://timvieira.github.io/blog/tag/rant.html">rant</a>,    <a href="https://timvieira.github.io/blog/tag/gumbel.html">Gumbel</a>,    <a href="https://timvieira.github.io/blog/tag/decision-making.html">decision-making</a>,    <a href="https://timvieira.github.io/blog/tag/hyperparameter-optimization.html">hyperparameter-optimization</a>,    <a href="https://timvieira.github.io/blog/tag/misc.html">misc</a>,    <a href="https://timvieira.github.io/blog/tag/numerical.html">numerical</a>,    <a href="https://timvieira.github.io/blog/tag/crf.html">crf</a>,    <a href="https://timvieira.github.io/blog/tag/deep-learning.html">deep-learning</a>,    <a href="https://timvieira.github.io/blog/tag/structured-prediction.html">structured-prediction</a>,    <a href="https://timvieira.github.io/blog/tag/visualization.html">visualization</a>  </section>



</aside>    <span class="toggle-sidebar"></span></div>
  </div><script id="mathjaxscript_pelican_#%@#$@#" type="text/javascript" src="MathJax.js">MathJax.Hub.Config({    config: ['MMLorHTML.js'],    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },    jax: ['input/TeX','input/MathML','output/HTML-CSS'],    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],    displayAlign: 'center',    displayIndent: '0em',    showMathMenu: true,    messageStyle: 'normal',    tex2jax: {         inlineMath: [ ['\\(','\\)'] ],         displayMath: [ ['$$','$$'] ],        processEscapes: true,        preview: 'TeX',    },     'HTML-CSS': {         styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} },        linebreaks: { automatic: false, width: '90% container' },    }, }); if ('default' !== 'default') {MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;VARIANT['normal'].fonts.unshift('MathJax_default');VARIANT['bold'].fonts.unshift('MathJax_default-bold');VARIANT['italic'].fonts.unshift('MathJax_default-italic');VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');});MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;VARIANT['normal'].fonts.unshift('MathJax_default');VARIANT['bold'].fonts.unshift('MathJax_default-bold');VARIANT['italic'].fonts.unshift('MathJax_default-italic');VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');});}</script>
  <footer role="contentinfo"><p>
    Copyright ©  2014–2018  Tim Vieira —
  <span class="credit">Powered by <a href="http://getpelican.com/">Pelican</a></span>
</p></footer>
  <script src="modernizr-2.js"></script>
  <script src="ender.js"></script>
  <script src="octopress.js" type="text/javascript"></script>
  <script type="text/javascript">
    var disqus_shortname = 'graduatedescent';
    var disqus_identifier = '/post/2017/08/18/backprop-is-not-just-the-chain-rule/';
    var disqus_url = '../../../../../post/2017/08/18/backprop-is-not-just-the-chain-rule/';
    var disqus_title = 'Backprop is not just the chain rule';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-8781169-1', 'auto');
  ga('send', 'pageview');
</script>

  

<iframe scrolling="no" style="background-color: transparent; border: 0px; display: none;" frameborder="0"></iframe><div id="GOOGLE_INPUT_CHEXT_FLAG" style="display: none;" input="" input_stat="{&quot;tlang&quot;:true,&quot;tsbc&quot;:true,&quot;pun&quot;:true,&quot;mk&quot;:true,&quot;ss&quot;:true}"></div><iframe style="display: none;"></iframe><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Main-bold, sans-serif;"></div></div></body></html>